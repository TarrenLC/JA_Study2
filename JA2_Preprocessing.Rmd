---
title: "JA2_Preprocessing"
author: "T.L"
date: "2022-08-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


# Packages

```{r Packages}



library(qualtRics) # Load in data straight from Qualtrics

library(tidyverse) # To tidy up data

library(janitor) # To clean up names in data

library(dlookr) # To use the diagnostics on numeric variables

library(rstatix) # For get_summary_stats functions and basic analyses like ANOVA etc

```

# Load in data

```{r Load in data}

#loading qualtrics API key first
qualtrics_api_credentials(api_key = "9nTtJm5yoaHANTmSRdCfVTA3nJFoeomJa1byTFxy",
                           base_url = "utsau.au1.qualtrics.com",
                           overwrite = TRUE,
                           install = TRUE)

readRenviron("~/.Renviron")

#loading in a datafile
#you can find the survey ID at the end of the qualtrics link - it starts with SV
rawdf <- fetch_survey(surveyID = "SV_3KHXpXtwYchFAua", force_request = TRUE, label = FALSE, convert = FALSE) 


#once you've loaded in all your datafiles this way, I suggest saving them into your file so you have the "raw" versions saved as a back-up
#otherwise they're only on qualtrics
#to do this, you'd follow this code for each of your datafiles
write.csv(rawdf, "JA_2_Raw_Qualtrics.csv", row.names = FALSE)


```

# Load in the completes datafile

```{r Tidy the data file}

completedf <- read.csv("JA_2022_August.csv")

sapply(completedf, class)

tidydf <- clean_names(completedf) 

## Select columns to keep

tidydf2 <- select(tidydf, ID = response_id, GENDER = q2, AGE = q3, MARITAL_STAT = q4, EDU = q5,
                  CURRENT_HEALTH = q6, CURRENT_MENTAL_ILLNESS = q9, MENTAL_ILLNESS = q10, ATTN_1 = a1,
                  DASS3 = dass3, DASS5 = dass5, DASS10 = dass10, DASS13 = dass13, DASS16 = dass16,
                  DASS17 = dass17, DASS21 = dass21, ATTN_2 = q224, TIME_P1_1 = time_p1_1_page_submit, PRAC1_1 = prac1_1,
                  TIME_P1_2 = time_p1_2_page_submit, PRAC1_2 = prac1_2, TIME_P1_3 = time_p1_3_page_submit, PRAC1_3 = prac1_3,
                  TIME_P2_1 = time_p2_1_page_submit, PRAC2_1 = prac2_1, TIME_P2_2 = time_p2_2_page_submit, PRAC2_2 = prac2_2,
                  TIME_P2_3 = time_p2_3_page_submit, PRAC2_3 = prac2_3, TIME_ET1_1 = time_et1_1_page_submit, ESTTASK1_1 = est_task1_1,
                  TIME_ET1_2 = time_et1_2_page_submit, ESTTASK1_2 = est_task1_2, TIME_ET1_3 = time_et1_3_page_submit, ESTTASK1_3 = est_task1_3,
                  TIME_ET1_4 = time_et1_4_page_submit, ESTTASK1_4 = est_task1_4, TIME_ET1_5 = time_et1_5_page_submit, ESTTASK1_5 = est_task1_5,
                  TIME_ET1_6 = time_et1_6_page_submit, ESTTASK1_6 = est_task1_6, TIME_ET1_7 = time_et1_7_page_submit, ESTTASK1_7 = est_task1_7,
                  TIME_ET1_8 = time_et1_8_page_submit, ESTTASK1_8 = est_task1_8, TIME_ET1_9 = time_et1_9_page_submit, ESTTASK1_9 = est_task1_9,
                  TIME_ET1_10 = time_et1_10_page_submit, ESTTASK1_10 = est_task1_10, TIME_ET1_11 = time_et1_11_page_submit, ESTTASK1_11 = est_task1_11,
                  TIME_ET1_12 = time_et1_12_page_submit, ESTTASK1_12 = est_task1_12, PRE_CONFIDENCE = est_task1_outro_1, EMO_REG = q218,
                  EMO_REG_EFFORT1 = q220_1, EMO_REG_EFFORT2 = q221_1, TIME_ET2_1 = time_et2_1_page_submit, ESTTASK2_1 = est_task2_1,
                  TIME_ET2_2 = time_et2_2_page_submit, ESTTASK2_2 = est_task2_2, TIME_ET2_3 = time_et2_3_page_submit, ESTTASK2_3 = est_task2_3,
                  TIME_ET2_4 = time_et2_4_page_submit, ESTTASK2_4 = est_task2_4, TIME_ET2_5 = time_et2_5_page_submit, ESTTASK2_5 = est_task2_5,
                  TIME_ET2_6 = time_et2_6_page_submit, ESTTASK2_6 = est_task2_6, TIME_ET2_7 = time_et2_7_page_submit, ESTTASK2_7 = est_task2_7,
                  TIME_ET2_8 = time_et2_8_page_submit, ESTTASK2_8 = est_task2_8, TIME_ET2_9 = time_et2_9_page_submit, ESTTASK2_9 = est_task2_9,
                  TIME_ET2_10 = time_et2_10_page_submit, ESTTASK2_10 = est_task2_10, TIME_ET2_11 = time_et2_11_page_submit, ESTTASK2_11 = est_task2_11,
                  TIME_ET2_12 = time_et2_12_page_submit, ESTTASK2_12 = est_task2_12, POST_CONFIDENCE = est_task2_outro_1, PERCEIVED_ADVICE_ACCURACY = est_task2_outro_2,
                  ls_7:ls_16, ns_9:ns_23, prac2_1_advice:est2_12_advice)

## Delete first 2 rows of data

tidydf2 <-tidydf2[-c(1:2) , ]

sapply(tidydf2, class)

## Convert character timing variables to numeric 

tidydf2$TIME_P1_1 <-  as.numeric(as.character(tidydf2$TIME_P1_1))
tidydf2$TIME_P1_2 <- as.numeric(as.character(tidydf2$TIME_P1_2))
tidydf2$TIME_P1_3 <- as.numeric(as.character(tidydf2$TIME_P1_3))
tidydf2$TIME_P2_1 <- as.numeric(as.character(tidydf2$TIME_P2_1))
tidydf2$TIME_P2_2 <- as.numeric(as.character(tidydf2$TIME_P2_2))
tidydf2$TIME_P2_3 <- as.numeric(as.character(tidydf2$TIME_P2_3))
tidydf2$TIME_ET1_1 <- as.numeric(as.character(tidydf2$TIME_ET1_1))
tidydf2$TIME_ET1_2 <- as.numeric(as.character(tidydf2$TIME_ET1_2))
tidydf2$TIME_ET1_3 <- as.numeric(as.character(tidydf2$TIME_ET1_3))
tidydf2$TIME_ET1_4 <- as.numeric(as.character(tidydf2$TIME_ET1_4))
tidydf2$TIME_ET1_5 <- as.numeric(as.character(tidydf2$TIME_ET1_5))
tidydf2$TIME_ET1_6 <- as.numeric(as.character(tidydf2$TIME_ET1_6))
tidydf2$TIME_ET1_7 <- as.numeric(as.character(tidydf2$TIME_ET1_7))
tidydf2$TIME_ET1_8 <- as.numeric(as.character(tidydf2$TIME_ET1_8))
tidydf2$TIME_ET1_9 <- as.numeric(as.character(tidydf2$TIME_ET1_9))
tidydf2$TIME_ET1_10 <- as.numeric(as.character(tidydf2$TIME_ET1_10))
tidydf2$TIME_ET1_11 <- as.numeric(as.character(tidydf2$TIME_ET1_11))
tidydf2$TIME_ET1_12 <- as.numeric(as.character(tidydf2$TIME_ET1_12))
tidydf2$TIME_ET2_1 <- as.numeric(as.character(tidydf2$TIME_ET2_1))
tidydf2$TIME_ET2_2 <- as.numeric(as.character(tidydf2$TIME_ET2_2))
tidydf2$TIME_ET2_3 <- as.numeric(as.character(tidydf2$TIME_ET2_3))
tidydf2$TIME_ET2_4 <- as.numeric(as.character(tidydf2$TIME_ET2_4))
tidydf2$TIME_ET2_5 <- as.numeric(as.character(tidydf2$TIME_ET2_5))
tidydf2$TIME_ET2_6 <- as.numeric(as.character(tidydf2$TIME_ET2_6))
tidydf2$TIME_ET2_7 <- as.numeric(as.character(tidydf2$TIME_ET2_7))
tidydf2$TIME_ET2_8 <- as.numeric(as.character(tidydf2$TIME_ET2_8))
tidydf2$TIME_ET2_9 <- as.numeric(as.character(tidydf2$TIME_ET2_9))
tidydf2$TIME_ET2_10 <- as.numeric(as.character(tidydf2$TIME_ET2_10))
tidydf2$TIME_ET2_11 <- as.numeric(as.character(tidydf2$TIME_ET2_11))
tidydf2$TIME_ET2_12 <- as.numeric(as.character(tidydf2$TIME_ET2_12))

timingdf <- data.frame(tidydf2$TIME_P1_1, tidydf2$TIME_P1_2, tidydf2$TIME_P1_3, tidydf2$TIME_P2_1, tidydf2$TIME_P2_2, tidydf2$TIME_P2_3,
                    tidydf2$TIME_ET1_1, tidydf2$TIME_ET1_2, tidydf2$TIME_ET1_3, tidydf2$TIME_ET1_4, tidydf2$TIME_ET1_5,
                    tidydf2$TIME_ET1_6, tidydf2$TIME_ET1_7, tidydf2$TIME_ET1_8, tidydf2$TIME_ET1_9, tidydf2$TIME_ET1_10,
                    tidydf2$TIME_ET1_11, tidydf2$TIME_ET1_12, tidydf2$TIME_ET2_1, tidydf2$TIME_ET2_2, tidydf2$TIME_ET2_3,
                    tidydf2$TIME_ET2_4, tidydf2$TIME_ET2_5, tidydf2$TIME_ET2_6, tidydf2$TIME_ET2_7, tidydf2$TIME_ET2_8,
                    tidydf2$TIME_ET2_9, tidydf2$TIME_ET2_10, tidydf2$TIME_ET2_11, tidydf2$TIME_ET2_12)


write.csv(timingdf, "JA_2_Timing_Variables.csv", row.names = FALSE) # Save the timing data to separate file


## Attempt to convert multiple columns at once 

tidydf3 <- select(tidydf2, AGE:CURRENT_HEALTH, ATTN_1:est2_12_advice) #create a new dataset with the columns you want to convert, use : to specify "from column x to column y"
tidydf3 <- lapply(tidydf3, function(x) as.integer(as.character(x)))
tidydf3=data.frame(tidydf3)
names(tidydf3)=paste(names(tidydf3),"n",sep = "") #rename the variables by adding an n to their name to differentiate them
tidydf4=cbind(tidydf3,tidydf2) #merge the 2 datasets into a new d4

## Bring ID to the first column position

tidydf4 <- tidydf4 %>% relocate(ID)

## Check which columns have NAs

colSums(is.na(tidydf4))

## Check numeric variables

diagnose_df <- diagnose_numeric(tidydf4) # A couple over very very small estimates...

## Noticed there is one person who has specified their education as 118 years
## Assuming extra 1 was a typo and changing to 18 years

tidydf4["117", "EDUn"] <- 18 ## df["rowname", "columnname"] <- value

## Remove the participants with potentially neuro mental health conditions

tidydf5 <- tidydf4[!(row.names(tidydf4) %in% c('15','17', '33', '44', '46', '54', '61', '75', '76', '89')), ]

structure(tidydf5)

## Remove trials where first estimate matches the advice

## Try on practice trials first ##

### Need to ensure that as.integer(NA) is specified! Otherwise, get errors about compatibility of vectors.

df6 <- tidydf5 %>% 
  rowwise(PRAC1_1n) %>% mutate(PRAC1_1n = ifelse(PRAC1_1n == prac2_1_advicen, as.integer(NA),PRAC1_1n))
  
df6 <- df6 %>%   
  rowwise(PRAC1_2n) %>% mutate(PRAC1_2n = ifelse(PRAC1_2n == prac2_2_advicen, as.integer(NA),PRAC1_2n))

df6 <- df6 %>% 
  rowwise(PRAC1_3n) %>% mutate(PRAC1_3n = ifelse(PRAC1_3n == prac2_3_advicen,as.integer(NA),PRAC1_3n)) 

# None came up

## Try removing actual trials...

df6 <- df6 %>% 
  rowwise(ESTTASK1_1n) %>% mutate(ESTTASK1_1n = ifelse(ESTTASK1_1n == est2_1_advicen,as.integer(NA),ESTTASK1_1n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_2n) %>% mutate(ESTTASK1_1n = ifelse(ESTTASK1_2n == est2_2_advicen,as.integer(NA),ESTTASK1_2n)) 

df6 <- df6 %>% 
  rowwise(ESTTASK1_3n) %>% mutate(ESTTASK1_3n = ifelse(ESTTASK1_3n == est2_3_advicen,as.integer(NA),ESTTASK1_3n)) 

df6 <- df6 %>% 
  rowwise(ESTTASK1_4n) %>% mutate(ESTTASK1_4n = ifelse(ESTTASK1_4n == est2_4_advicen,as.integer(NA),ESTTASK1_4n)) 

df6 <- df6 %>% 
  rowwise(ESTTASK1_5n) %>% mutate(ESTTASK1_5n = ifelse(ESTTASK1_5n == est2_5_advicen,as.integer(NA),ESTTASK1_5n)) 

df6 <- df6 %>% 
  rowwise(ESTTASK1_6n) %>% mutate(ESTTASK1_6n = ifelse(ESTTASK1_6n == est2_6_advicen,as.integer(NA),ESTTASK1_6n)) 

df6 <- df6 %>% 
  rowwise(ESTTASK1_7n) %>% mutate(ESTTASK1_7n = ifelse(ESTTASK1_7n == est2_7_advicen,as.integer(NA),ESTTASK1_7n)) 

df6 <- df6 %>% 
  rowwise(ESTTASK1_8n) %>% mutate(ESTTASK1_8n = ifelse(ESTTASK1_8n == est2_8_advicen,as.integer(NA),ESTTASK1_8n)) 

df6 <- df6 %>% 
  rowwise(ESTTASK1_9n) %>% mutate(ESTTASK1_9n = ifelse(ESTTASK1_9n == est2_9_advicen,as.integer(NA),ESTTASK1_9n)) 

df6 <- df6 %>% 
  rowwise(ESTTASK1_10n) %>% mutate(ESTTASK1_10n = ifelse(ESTTASK1_10n == est2_10_advicen,as.integer(NA),ESTTASK1_10n)) 

df6 <- df6 %>% 
  rowwise(ESTTASK1_11n) %>% mutate(ESTTASK1_11n = ifelse(ESTTASK1_11n == est2_11_advicen,as.integer(NA),ESTTASK1_11n)) 

df6 <- df6 %>% 
  rowwise(ESTTASK1_12n) %>% mutate(ESTTASK1_12n = ifelse(ESTTASK1_12n == est2_12_advicen,as.integer(NA),ESTTASK1_12n)) 


### Add column with age group

df6$AGEGROUP <- dplyr::case_when (df6$AGEn <= 39 ~ 'YOUNG',
                                df6$AGEn <= 64 ~ 'MIDDLE',
                                df6$AGEn >= 65 ~ 'OLDER')


### Number of NAs for each age group

nacount1 <- df6 %>%
  group_by(AGEGROUP) %>%  # replace to your needs
  summarise_all(funs(sum(is.na(.))))
  

```


# Create WoAs for each jar ###########################
```{r}

## Make WOA values for each jar for each person.

df6$PRAC01_WOA <- (df6$PRAC2_1n-df6$PRAC1_1n)/(df6$prac2_1_advicen-df6$PRAC1_1n)

df6$PRAC02_WOA <- (df6$PRAC2_2n-df6$PRAC1_2n)/(df6$prac2_2_advicen-df6$PRAC1_2n)

df6$PRAC03_WOA <- (df6$PRAC2_3n-df6$PRAC1_3n)/(df6$prac2_3_advicen-df6$PRAC1_3n)

df6$JAR01_WOA <- (df6$ESTTASK2_1n-df6$ESTTASK1_1n)/(df6$est2_1_advicen-df6$ESTTASK1_1n)

df6$JAR02_WOA <- (df6$ESTTASK2_2n-df6$ESTTASK1_2n)/(df6$est2_2_advicen-df6$ESTTASK1_2n)

df6$JAR03_WOA <- (df6$ESTTASK2_3n-df6$ESTTASK1_3n)/(df6$est2_3_advicen-df6$ESTTASK1_3n)

df6$JAR04_WOA <- (df6$ESTTASK2_4n-df6$ESTTASK1_4n)/(df6$est2_4_advicen-df6$ESTTASK1_4n)

df6$JAR05_WOA <- (df6$ESTTASK2_5n-df6$ESTTASK1_5n)/(df6$est2_5_advicen-df6$ESTTASK1_5n)

df6$JAR06_WOA <- (df6$ESTTASK2_6n-df6$ESTTASK1_6n)/(df6$est2_6_advicen-df6$ESTTASK1_6n)

df6$JAR07_WOA <- (df6$ESTTASK2_7n-df6$ESTTASK1_7n)/(df6$est2_7_advicen-df6$ESTTASK1_7n)

df6$JAR08_WOA <- (df6$ESTTASK2_8n-df6$ESTTASK1_8n)/(df6$est2_8_advicen-df6$ESTTASK1_8n)

df6$JAR09_WOA <- (df6$ESTTASK2_9n-df6$ESTTASK1_9n)/(df6$est2_9_advicen-df6$ESTTASK1_9n)

df6$JAR10_WOA <- (df6$ESTTASK2_10n-df6$ESTTASK1_10n)/(df6$est2_10_advicen-df6$ESTTASK1_10n)

df6$JAR11_WOA <- (df6$ESTTASK2_11n-df6$ESTTASK1_11n)/(df6$est2_11_advicen-df6$ESTTASK1_11n)

df6$JAR12_WOA <- (df6$ESTTASK2_12n-df6$ESTTASK1_12n)/(df6$est2_12_advicen-df6$ESTTASK1_12n)


```


# Create depression symptom severity scores
```{r}

df7 <- df6 %>%
  rowwise() %>%
  mutate(DASS = sum(c(DASS3n, DASS5n, DASS10n, DASS13n, DASS16n, DASS17n, DASS21n), na.rm=T))

### Add depressive symptom category

df7$DASS_SEVERITY<- dplyr::case_when (df7$DASS <= 4 ~ 'NORMAL',
                                df7$DASS <= 6 ~ 'MILD',
                                df7$DASS <= 10 ~ 'MODERATE',
                                df7$DASS <= 13 ~ 'SEVERE',
                                df7$DASS >= 14 ~ 'EXTREMELY_SEVERE')

df7$AGEGROUP <- factor(df7$AGEGROUP, levels = c("YOUNG", "MIDDLE", "OLDER"))

df7$DASS_SEVERITY <- factor(df7$DASS_SEVERITY, levels = c("NORMAL", "MILD", "MODERATE", "SEVERE", "ESTREMELY_SEVERE"))

my_summary <- df7 %>%
  count(DASS_SEVERITY, AGEGROUP, sort = TRUE) 

```


# Sum together fluid IQ and number scores
```{r}

df7 <- df7 %>% 
  rowwise() %>%
  mutate(FLUIDIQ = sum(c(ls_7n, ls_8n, ls_9n, ls_10n, ls_11n, ls_12n, ls_13n, ls_14n,
                         ls_15n, ls_16n), na.rm=T))

df7 <- df7 %>% 
  rowwise() %>% 
  mutate(NUMIQ = sum(c(ns_9n, ns_10n, ns_11n, ns_12n, ns_13n, ns_14n, ns_15n, ns_16n,
                       ns_17n, ns_18n, ns_19n, ns_20n, ns_21n, ns_22n, ns_23n), na.rm=T))

## Create average score for fluid IQ

df7 <- df7 %>% 
  rowwise() %>% 
  mutate(AVFLUIDIQ = mean(c(FLUIDIQ, NUMIQ)))

```


# Remove WOA values smaller than -1.3 or larger than 1.3
```{r}

## Remove from practice trials

df7 <- df7 %>% 
  rowwise(PRAC01_WOA) %>% mutate(PRAC01_WOA = ifelse(PRAC01_WOA > 1.3|PRAC01_WOA < -1.3, as.integer(NA),PRAC01_WOA))
  
df7 <- df7 %>% 
  rowwise(PRAC02_WOA) %>% mutate(PRAC02_WOA = ifelse(PRAC02_WOA > 1.3|PRAC02_WOA < -1.3, as.integer(NA),PRAC02_WOA))

df7 <- df7 %>% 
  rowwise(PRAC03_WOA) %>% mutate(PRAC03_WOA = ifelse(PRAC03_WOA > 1.3|PRAC03_WOA < -1.3, as.integer(NA),PRAC03_WOA))


## Actual trials

df7 <- df7 %>% 
  rowwise(JAR01_WOA) %>% mutate(JAR01_WOA = ifelse(JAR01_WOA > 1.3|JAR01_WOA < -1.3, as.integer(NA),JAR01_WOA))

df7 <- df7 %>% 
  rowwise(JAR02_WOA) %>% mutate(JAR02_WOA = ifelse(JAR02_WOA > 1.3|JAR02_WOA < -1.3, as.integer(NA),JAR02_WOA))

df7 <- df7 %>% 
  rowwise(JAR03_WOA) %>% mutate(JAR03_WOA = ifelse(JAR03_WOA > 1.3|JAR03_WOA < -1.3, as.integer(NA),JAR03_WOA))

df7 <- df7 %>% 
  rowwise(JAR04_WOA) %>% mutate(JAR04_WOA = ifelse(JAR04_WOA > 1.3|JAR04_WOA < -1.3, as.integer(NA),JAR04_WOA))

df7 <- df7 %>% 
  rowwise(JAR05_WOA) %>% mutate(JAR05_WOA = ifelse(JAR05_WOA > 1.3|JAR05_WOA < -1.3, as.integer(NA),JAR05_WOA))

df7 <- df7 %>% 
  rowwise(JAR06_WOA) %>% mutate(JAR06_WOA = ifelse(JAR06_WOA > 1.3|JAR06_WOA < -1.3, as.integer(NA),JAR06_WOA))

df7 <- df7 %>% 
  rowwise(JAR07_WOA) %>% mutate(JAR07_WOA = ifelse(JAR07_WOA > 1.3|JAR07_WOA < -1.3, as.integer(NA),JAR07_WOA))

df7 <- df7 %>% 
  rowwise(JAR08_WOA) %>% mutate(JAR08_WOA = ifelse(JAR08_WOA > 1.3|JAR08_WOA < -1.3, as.integer(NA),JAR08_WOA))

df7 <- df7 %>% 
  rowwise(JAR09_WOA) %>% mutate(JAR09_WOA = ifelse(JAR09_WOA > 1.3|JAR09_WOA < -1.3, as.integer(NA),JAR09_WOA))

df7 <- df7 %>% 
  rowwise(JAR10_WOA) %>% mutate(JAR10_WOA = ifelse(JAR10_WOA > 1.3|JAR10_WOA < -1.3, as.integer(NA),JAR10_WOA))

df7 <- df7 %>% 
  rowwise(JAR11_WOA) %>% mutate(JAR11_WOA = ifelse(JAR11_WOA > 1.3|JAR11_WOA < -1.3, as.integer(NA),JAR11_WOA))

df7 <- df7 %>% 
  rowwise(JAR12_WOA) %>% mutate(JAR12_WOA = ifelse(JAR12_WOA > 1.3|JAR12_WOA < -1.3, as.integer(NA),JAR12_WOA))

## Get NA counts

### Number of NAs for each age group

nacount2 <- df7 %>%
  group_by(AGEGROUP) %>%  # replace to your needs
  summarise_all(funs(sum(is.na(.))))

```


# Get M and SD for each age groups WOA values
```{r}

summarystats_jars <- df7 %>% 
  group_by(AGEGROUP) %>%
  get_summary_stats(PRAC01_WOA, PRAC02_WOA, PRAC03_WOA, type = "mean_sd")

## Split into age groups
young <- subset(df7, AGEGROUP == "YOUNG")

middle <- subset(df7, AGEGROUP == "MIDDLE")

older <- subset(df7, AGEGROUP == "OLDER")

## keep getting an error - see if it happens on a dummy data frame.

# dummydf <- data.frame(id = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                     # woa = c(0.8, 0.8, -0.5, 1, -0.3, 0.3, -0.09, NA, NA))

# dummydf <- dummydf %>% 
 # rowwise(woa) %>% mutate(woa = ifelse(woa < -0.1, "less", woa))

## got the same error

## Check structure of the data

# structure(dummydf)

# dummydf$woa <- as.numeric(as.character(dummydf$woa))

# dummydf <- dummydf %>% 
  # rowwise(woa) %>% mutate(woa = ifelse(woa < -0.1, -100, woa)) ### This fixes it - I believe the error was to do with trying
### to replace the value with a word (character)


## Young - practice jars.

## Young prac jar 1 M + 3*SD

0.840 + (3*0.307)

# 1.761

## Young prac Jar 1 M - 3*SD

0.840 - (3*0.307)

# -0.081

young <- young %>% 
  rowwise(PRAC01_WOA) %>% mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                                                     ifelse(PRAC01_WOA > 1.761, 100, PRAC01_WOA)))

young <- young %>%
  rowwise(PRAC01_WOA) %>% mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                                                     ifelse(PRAC01_WOA < -0.081, -100, PRAC01_WOA)))

## Young prac jar 2 M + 3*SD

0.814 + (3*0.344)

# 1.846

## Young prac jar 2 M - 3*SD

0.814 - (3*0.344)

# -0.218

young <- young %>% 
  rowwise(PRAC02_WOA) %>% mutate(PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                                                     ifelse(PRAC02_WOA > 1.846, 100, PRAC02_WOA)))

young <- young %>%
  rowwise(PRAC02_WOA) %>% mutate(PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                                                     ifelse(PRAC02_WOA < -0.218, -100, PRAC02_WOA)))

## Young prac jar 3 M + 3*SD

0.798 + (3*0.388)

# 1.962

## Young prac jar 3 M - 3*SD

0.798 - (3*0.388)

# -0.366

young <- young %>% 
  rowwise(PRAC03_WOA) %>% mutate(PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                                                     ifelse(PRAC03_WOA > 1.962, 100, PRAC03_WOA)))

young <- young %>%
  rowwise(PRAC03_WOA) %>% mutate(PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                                                     ifelse(PRAC03_WOA < -0.366, -100, PRAC03_WOA)))



```


