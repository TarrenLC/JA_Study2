---
title: "JA2_Preprocessing"
author: "T.L"
date: "2022-08-10"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Packages

```{r Packages}



library(qualtRics) # Load in data straight from Qualtrics

library(tidyverse) # To tidy up data

library(janitor) # To clean up names in data

library(dlookr) # To use the diagnostics on numeric variables

library(rstatix) # For get_summary_stats functions and basic analyses like ANOVA etc

library(psych) # To check reliability

```

# Load in data

```{r Load in data}

#loading qualtrics API key first
qualtrics_api_credentials(api_key = "9nTtJm5yoaHANTmSRdCfVTA3nJFoeomJa1byTFxy",
                           base_url = "utsau.au1.qualtrics.com",
                           overwrite = TRUE,
                           install = TRUE)

readRenviron("~/.Renviron")

#loading in a datafile
#you can find the survey ID at the end of the qualtrics link - it starts with SV
rawdf <- fetch_survey(surveyID = "SV_3KHXpXtwYchFAua", force_request = TRUE, label = FALSE, convert = FALSE) 


#once you've loaded in all your datafiles this way, I suggest saving them into your file so you have the "raw" versions saved as a back-up
#otherwise they're only on qualtrics
#to do this, you'd follow this code for each of your datafiles
write.csv(rawdf, "JA_2_Raw_Qualtrics.csv", row.names = FALSE)


```

# Load in the completes datafile

```{r Tidy the data file}

completedf <- read.csv("JA_2022_August.csv")

sapply(completedf, class)

tidydf <- clean_names(completedf) 

## Select columns to keep

tidydf2 <- select(tidydf, ID = response_id, GENDER = q2, AGE = q3, MARITAL_STAT = q4, EDU = q5,
                  CURRENT_HEALTH = q6, CURRENT_MENTAL_ILLNESS = q9, MENTAL_ILLNESS = q10, ATTN_1 = a1,
                  DASS3 = dass3, DASS5 = dass5, DASS10 = dass10, DASS13 = dass13, DASS16 = dass16,
                  DASS17 = dass17, DASS21 = dass21, ATTN_2 = q224, TIME_P1_1 = time_p1_1_page_submit, PRAC1_1 = prac1_1,
                  TIME_P1_2 = time_p1_2_page_submit, PRAC1_2 = prac1_2, TIME_P1_3 = time_p1_3_page_submit, PRAC1_3 = prac1_3,
                  TIME_P2_1 = time_p2_1_page_submit, PRAC2_1 = prac2_1, TIME_P2_2 = time_p2_2_page_submit, PRAC2_2 = prac2_2,
                  TIME_P2_3 = time_p2_3_page_submit, PRAC2_3 = prac2_3, TIME_ET1_1 = time_et1_1_page_submit, ESTTASK1_1 = est_task1_1,
                  TIME_ET1_2 = time_et1_2_page_submit, ESTTASK1_2 = est_task1_2, TIME_ET1_3 = time_et1_3_page_submit, ESTTASK1_3 = est_task1_3,
                  TIME_ET1_4 = time_et1_4_page_submit, ESTTASK1_4 = est_task1_4, TIME_ET1_5 = time_et1_5_page_submit, ESTTASK1_5 = est_task1_5,
                  TIME_ET1_6 = time_et1_6_page_submit, ESTTASK1_6 = est_task1_6, TIME_ET1_7 = time_et1_7_page_submit, ESTTASK1_7 = est_task1_7,
                  TIME_ET1_8 = time_et1_8_page_submit, ESTTASK1_8 = est_task1_8, TIME_ET1_9 = time_et1_9_page_submit, ESTTASK1_9 = est_task1_9,
                  TIME_ET1_10 = time_et1_10_page_submit, ESTTASK1_10 = est_task1_10, TIME_ET1_11 = time_et1_11_page_submit, ESTTASK1_11 = est_task1_11,
                  TIME_ET1_12 = time_et1_12_page_submit, ESTTASK1_12 = est_task1_12, PRE_CONFIDENCE = est_task1_outro_1, EMO_REG = q218,
                  EMO_REG_EFFORT1 = q220_1, EMO_REG_EFFORT2 = q221_1, TIME_ET2_1 = time_et2_1_page_submit, ESTTASK2_1 = est_task2_1,
                  TIME_ET2_2 = time_et2_2_page_submit, ESTTASK2_2 = est_task2_2, TIME_ET2_3 = time_et2_3_page_submit, ESTTASK2_3 = est_task2_3,
                  TIME_ET2_4 = time_et2_4_page_submit, ESTTASK2_4 = est_task2_4, TIME_ET2_5 = time_et2_5_page_submit, ESTTASK2_5 = est_task2_5,
                  TIME_ET2_6 = time_et2_6_page_submit, ESTTASK2_6 = est_task2_6, TIME_ET2_7 = time_et2_7_page_submit, ESTTASK2_7 = est_task2_7,
                  TIME_ET2_8 = time_et2_8_page_submit, ESTTASK2_8 = est_task2_8, TIME_ET2_9 = time_et2_9_page_submit, ESTTASK2_9 = est_task2_9,
                  TIME_ET2_10 = time_et2_10_page_submit, ESTTASK2_10 = est_task2_10, TIME_ET2_11 = time_et2_11_page_submit, ESTTASK2_11 = est_task2_11,
                  TIME_ET2_12 = time_et2_12_page_submit, ESTTASK2_12 = est_task2_12, POST_CONFIDENCE = est_task2_outro_1, PERCEIVED_ADVICE_ACCURACY = est_task2_outro_2,
                  ls_7:ls_16, ns_9:ns_23, prac2_1_advice:est2_12_advice)

## Delete first 2 rows of data

tidydf2 <-tidydf2[-c(1:2) , ]

sapply(tidydf2, class)

## Convert character timing variables to numeric 

tidydf2$TIME_P1_1 <-  as.numeric(as.character(tidydf2$TIME_P1_1))
tidydf2$TIME_P1_2 <- as.numeric(as.character(tidydf2$TIME_P1_2))
tidydf2$TIME_P1_3 <- as.numeric(as.character(tidydf2$TIME_P1_3))
tidydf2$TIME_P2_1 <- as.numeric(as.character(tidydf2$TIME_P2_1))
tidydf2$TIME_P2_2 <- as.numeric(as.character(tidydf2$TIME_P2_2))
tidydf2$TIME_P2_3 <- as.numeric(as.character(tidydf2$TIME_P2_3))
tidydf2$TIME_ET1_1 <- as.numeric(as.character(tidydf2$TIME_ET1_1))
tidydf2$TIME_ET1_2 <- as.numeric(as.character(tidydf2$TIME_ET1_2))
tidydf2$TIME_ET1_3 <- as.numeric(as.character(tidydf2$TIME_ET1_3))
tidydf2$TIME_ET1_4 <- as.numeric(as.character(tidydf2$TIME_ET1_4))
tidydf2$TIME_ET1_5 <- as.numeric(as.character(tidydf2$TIME_ET1_5))
tidydf2$TIME_ET1_6 <- as.numeric(as.character(tidydf2$TIME_ET1_6))
tidydf2$TIME_ET1_7 <- as.numeric(as.character(tidydf2$TIME_ET1_7))
tidydf2$TIME_ET1_8 <- as.numeric(as.character(tidydf2$TIME_ET1_8))
tidydf2$TIME_ET1_9 <- as.numeric(as.character(tidydf2$TIME_ET1_9))
tidydf2$TIME_ET1_10 <- as.numeric(as.character(tidydf2$TIME_ET1_10))
tidydf2$TIME_ET1_11 <- as.numeric(as.character(tidydf2$TIME_ET1_11))
tidydf2$TIME_ET1_12 <- as.numeric(as.character(tidydf2$TIME_ET1_12))
tidydf2$TIME_ET2_1 <- as.numeric(as.character(tidydf2$TIME_ET2_1))
tidydf2$TIME_ET2_2 <- as.numeric(as.character(tidydf2$TIME_ET2_2))
tidydf2$TIME_ET2_3 <- as.numeric(as.character(tidydf2$TIME_ET2_3))
tidydf2$TIME_ET2_4 <- as.numeric(as.character(tidydf2$TIME_ET2_4))
tidydf2$TIME_ET2_5 <- as.numeric(as.character(tidydf2$TIME_ET2_5))
tidydf2$TIME_ET2_6 <- as.numeric(as.character(tidydf2$TIME_ET2_6))
tidydf2$TIME_ET2_7 <- as.numeric(as.character(tidydf2$TIME_ET2_7))
tidydf2$TIME_ET2_8 <- as.numeric(as.character(tidydf2$TIME_ET2_8))
tidydf2$TIME_ET2_9 <- as.numeric(as.character(tidydf2$TIME_ET2_9))
tidydf2$TIME_ET2_10 <- as.numeric(as.character(tidydf2$TIME_ET2_10))
tidydf2$TIME_ET2_11 <- as.numeric(as.character(tidydf2$TIME_ET2_11))
tidydf2$TIME_ET2_12 <- as.numeric(as.character(tidydf2$TIME_ET2_12))

timingdf <- data.frame(tidydf2$TIME_P1_1, tidydf2$TIME_P1_2, tidydf2$TIME_P1_3, tidydf2$TIME_P2_1, tidydf2$TIME_P2_2, tidydf2$TIME_P2_3,
                    tidydf2$TIME_ET1_1, tidydf2$TIME_ET1_2, tidydf2$TIME_ET1_3, tidydf2$TIME_ET1_4, tidydf2$TIME_ET1_5,
                    tidydf2$TIME_ET1_6, tidydf2$TIME_ET1_7, tidydf2$TIME_ET1_8, tidydf2$TIME_ET1_9, tidydf2$TIME_ET1_10,
                    tidydf2$TIME_ET1_11, tidydf2$TIME_ET1_12, tidydf2$TIME_ET2_1, tidydf2$TIME_ET2_2, tidydf2$TIME_ET2_3,
                    tidydf2$TIME_ET2_4, tidydf2$TIME_ET2_5, tidydf2$TIME_ET2_6, tidydf2$TIME_ET2_7, tidydf2$TIME_ET2_8,
                    tidydf2$TIME_ET2_9, tidydf2$TIME_ET2_10, tidydf2$TIME_ET2_11, tidydf2$TIME_ET2_12)


write.csv(timingdf, "JA_2_Timing_Variables.csv", row.names = FALSE) # Save the timing data to separate file


## Attempt to convert multiple columns at once 

tidydf3 <- select(tidydf2, GENDER:CURRENT_HEALTH, ATTN_1:est2_12_advice) #create a new dataset with the columns you want to convert, use : to specify "from column x to column y"
tidydf3 <- lapply(tidydf3, function(x) as.integer(as.character(x)))
tidydf3=data.frame(tidydf3)
names(tidydf3)=paste(names(tidydf3),"n",sep = "") #rename the variables by adding an n to their name to differentiate them
tidydf4=cbind(tidydf3,tidydf2) #merge the 2 datasets into a new d4

## Bring ID to the first column position

tidydf4 <- tidydf4 %>% relocate(ID)

## Check which columns have NAs

colSums(is.na(tidydf4))

## Check numeric variables

diagnose_df <- diagnose_numeric(tidydf4) # A couple over very very small estimates...

## Noticed there is one person who has specified their education as 118 years
## Assuming extra 1 was a typo and changing to 18 years

tidydf4["117", "EDUn"] <- 18 ## df["rowname", "columnname"] <- value

## Remove the participants with potentially neuro mental health conditions

tidydf5 <- tidydf4[!(row.names(tidydf4) %in% c('15','17', '33', '44', '46', '54', '61', '75', '76', '89')), ]

structure(tidydf5)

```

# Remove trials where first estimate matches the advice
```{r}

## Get total numbers estimates (1st and 2nd round) for practice, and then proper.

prac_total <- tidydf5 %>% 
  get_summary_stats(PRAC1_1n, PRAC1_2n, PRAC1_3n, PRAC2_1n, PRAC2_2n,
                    PRAC2_3n, type = "common")

sum(prac_total$n) # 936

## Try on practice trials first ##

### Need to ensure that as.integer(NA) is specified! Otherwise, get errors about compatibility of vectors.

df6 <- tidydf5 %>% 
  rowwise(PRAC1_1n) %>% mutate(PRAC1_1n = ifelse(PRAC1_1n == prac2_1_advicen, as.integer(NA),PRAC1_1n)) %>% 
  rowwise(PRAC2_1n) %>% mutate(PRAC2_1n = ifelse(PRAC1_1n == prac2_1_advicen, as.integer(NA),PRAC2_1n))
  
df6 <- df6 %>%   
  rowwise(PRAC1_2n) %>% mutate(PRAC1_2n = ifelse(PRAC1_2n == prac2_2_advicen, as.integer(NA),PRAC1_2n)) %>% 
  rowwise(PRAC2_2n) %>% mutate(PRAC2_2n = ifelse(PRAC1_2n == prac2_2_advicen, as.integer(NA),PRAC2_2n))

df6 <- df6 %>% 
  rowwise(PRAC1_3n) %>% mutate(PRAC1_3n = ifelse(PRAC1_3n == prac2_3_advicen,as.integer(NA),PRAC1_3n)) %>% 
  rowwise(PRAC2_3n) %>% mutate(PRAC2_3n = ifelse(PRAC1_3n == prac2_3_advicen,as.integer(NA),PRAC2_3n))


## Remove actual trials - take out both estimates if first estimate matches advice

## Get totals

esttask_total <- tidydf5 %>% 
  get_summary_stats(ESTTASK1_1n, ESTTASK1_2n, ESTTASK1_3n, ESTTASK1_4n,
                    ESTTASK1_5n, ESTTASK1_6n, ESTTASK1_7n, ESTTASK1_8n,
                    ESTTASK1_9n, ESTTASK1_10n, ESTTASK1_11n, ESTTASK1_12n,
                    ESTTASK2_1n, ESTTASK2_2n, ESTTASK2_3n, ESTTASK2_4n,
                    ESTTASK2_5n, ESTTASK2_6n, ESTTASK2_7n, ESTTASK2_8n,
                    ESTTASK2_9n, ESTTASK2_10n, ESTTASK2_11n, ESTTASK2_12n, type = "common")

sum(esttask_total$n) # 3744

df6 <- df6 %>% 
  rowwise(ESTTASK1_1n) %>% mutate(ESTTASK1_1n = ifelse(ESTTASK1_1n == est2_1_advicen,as.integer(NA),ESTTASK1_1n)) %>%
  rowwise(ESTTASK2_1n) %>% mutate(ESTTASK2_1n = ifelse(ESTTASK1_1n == est2_1_advicen,as.integer(NA),ESTTASK1_2n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_2n) %>% mutate(ESTTASK1_2n = ifelse(ESTTASK1_2n == est2_2_advicen,as.integer(NA),ESTTASK1_2n)) %>% 
  rowwise(ESTTASK2_2n) %>% mutate(ESTTASK2_2n = ifelse(ESTTASK1_2n == est2_2_advicen,as.integer(NA),ESTTASK2_2n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_3n) %>% mutate(ESTTASK1_3n = ifelse(ESTTASK1_3n == est2_3_advicen,as.integer(NA),ESTTASK1_3n)) %>% 
  rowwise(ESTTASK2_3n) %>% mutate(ESTTASK2_3n = ifelse(ESTTASK1_3n == est2_3_advicen,as.integer(NA),ESTTASK2_3n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_4n) %>% mutate(ESTTASK1_4n = ifelse(ESTTASK1_4n == est2_4_advicen,as.integer(NA),ESTTASK1_4n)) %>% 
  rowwise(ESTTASK2_4n) %>% mutate(ESTTASK2_4n = ifelse(ESTTASK1_4n == est2_4_advicen,as.integer(NA),ESTTASK2_4n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_5n) %>% mutate(ESTTASK1_5n = ifelse(ESTTASK1_5n == est2_5_advicen,as.integer(NA),ESTTASK1_5n)) %>% 
  rowwise(ESTTASK2_5n) %>% mutate(ESTTASK2_5n = ifelse(ESTTASK1_5n == est2_5_advicen,as.integer(NA),ESTTASK2_5n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_6n) %>% mutate(ESTTASK1_6n = ifelse(ESTTASK1_6n == est2_6_advicen,as.integer(NA),ESTTASK1_6n)) %>% 
  rowwise(ESTTASK2_6n) %>% mutate(ESTTASK2_6n = ifelse(ESTTASK1_6n == est2_6_advicen,as.integer(NA),ESTTASK2_6n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_7n) %>% mutate(ESTTASK1_7n = ifelse(ESTTASK1_7n == est2_7_advicen,as.integer(NA),ESTTASK1_7n)) %>% 
  rowwise(ESTTASK2_7n) %>% mutate(ESTTASK2_7n = ifelse(ESTTASK1_7n == est2_7_advicen,as.integer(NA),ESTTASK2_7n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_8n) %>% mutate(ESTTASK1_8n = ifelse(ESTTASK1_8n == est2_8_advicen,as.integer(NA),ESTTASK1_8n)) %>% 
  rowwise(ESTTASK2_8n) %>% mutate(ESTTASK2_8n = ifelse(ESTTASK1_8n == est2_8_advicen,as.integer(NA),ESTTASK2_8n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_9n) %>% mutate(ESTTASK1_9n = ifelse(ESTTASK1_9n == est2_9_advicen,as.integer(NA),ESTTASK1_9n)) %>% 
  rowwise(ESTTASK2_9n) %>% mutate(ESTTASK2_9n = ifelse(ESTTASK1_9n == est2_9_advicen,as.integer(NA),ESTTASK2_9n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_10n) %>% mutate(ESTTASK1_10n = ifelse(ESTTASK1_10n == est2_10_advicen,as.integer(NA),ESTTASK1_10n)) %>% 
  rowwise(ESTTASK2_10n) %>% mutate(ESTTASK2_10n = ifelse(ESTTASK1_10n == est2_10_advicen,as.integer(NA),ESTTASK2_10n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_11n) %>% mutate(ESTTASK1_11n = ifelse(ESTTASK1_11n == est2_11_advicen,as.integer(NA),ESTTASK1_11n)) %>% 
  rowwise(ESTTASK2_11n) %>% mutate(ESTTASK2_11n = ifelse(ESTTASK1_11n == est2_11_advicen,as.integer(NA),ESTTASK2_11n))

df6 <- df6 %>% 
  rowwise(ESTTASK1_12n) %>% mutate(ESTTASK1_12n = ifelse(ESTTASK1_12n == est2_12_advicen,as.integer(NA),ESTTASK1_12n)) %>% 
  rowwise(ESTTASK2_12n) %>% mutate(ESTTASK2_12n = ifelse(ESTTASK1_12n == est2_12_advicen,as.integer(NA),ESTTASK2_12n))


### Add column with age group

df6$AGEGROUP <- dplyr::case_when (df6$AGEn <= 39 ~ 'YOUNG',
                                df6$AGEn <= 64 ~ 'MIDDLE',
                                df6$AGEn >= 65 ~ 'OLDER')


### Number of NAs for each age group

#nacount1 <- df6 %>%
#  group_by(AGEGROUP) %>%  # replace to your needs
#  summarise_all(funs(sum(is.na(.))))
  
# Trials proper
nacount1 <- df6 %>%
  group_by(AGEGROUP) %>%  
  select(AGEGROUP, ESTTASK1_1n, ESTTASK1_2n, ESTTASK1_3n, ESTTASK1_4n, 
         ESTTASK1_5n, ESTTASK1_6n, ESTTASK1_7n, ESTTASK1_8n, ESTTASK1_9n, 
         ESTTASK1_10n, ESTTASK1_11n, ESTTASK1_12n, ESTTASK2_1n, ESTTASK2_2n,
         ESTTASK2_3n, ESTTASK2_4n, ESTTASK2_5n, ESTTASK2_6n, ESTTASK2_7n,
         ESTTASK2_8n, ESTTASK2_9n, ESTTASK2_10n, ESTTASK2_11n, ESTTASK2_12n) %>% # replace to your needs
  summarise_all(funs(sum(is.na(.))))

# 2 for young

2/3744  # .01% of trials for young

# 8 for middle

8/3744  # .02% of trials for middle

# 6 for older

6/3744  # .02% of trials for older

# Practice
nacount1_prac <- df6 %>%
  group_by(AGEGROUP) %>%  
  select(AGEGROUP, PRAC1_1n, PRAC1_2n, PRAC1_3n,
         PRAC2_1n, PRAC2_2n, PRAC2_3n) %>% # replace to your needs
  summarise_all(funs(sum(is.na(.))))

df6 %>% ungroup()

# 2 for young

2/936 # .02%

# 2 for older

2 / 936 # .02%


```



# Create WoAs for each jar
```{r}

## Make WOA values for each jar for each person.

df6$PRAC01_WOA <- (df6$PRAC2_1n-df6$PRAC1_1n)/(df6$prac2_1_advicen-df6$PRAC1_1n) 

df6$PRAC02_WOA <- (df6$PRAC2_2n-df6$PRAC1_2n)/(df6$prac2_2_advicen-df6$PRAC1_2n)

df6$PRAC03_WOA <- (df6$PRAC2_3n-df6$PRAC1_3n)/(df6$prac2_3_advicen-df6$PRAC1_3n)

df6$JAR01_WOA <- (df6$ESTTASK2_1n-df6$ESTTASK1_1n)/(df6$est2_1_advicen-df6$ESTTASK1_1n)

df6$JAR02_WOA <- (df6$ESTTASK2_2n-df6$ESTTASK1_2n)/(df6$est2_2_advicen-df6$ESTTASK1_2n)

df6$JAR03_WOA <- (df6$ESTTASK2_3n-df6$ESTTASK1_3n)/(df6$est2_3_advicen-df6$ESTTASK1_3n)

df6$JAR04_WOA <- (df6$ESTTASK2_4n-df6$ESTTASK1_4n)/(df6$est2_4_advicen-df6$ESTTASK1_4n)

df6$JAR05_WOA <- (df6$ESTTASK2_5n-df6$ESTTASK1_5n)/(df6$est2_5_advicen-df6$ESTTASK1_5n)

df6$JAR06_WOA <- (df6$ESTTASK2_6n-df6$ESTTASK1_6n)/(df6$est2_6_advicen-df6$ESTTASK1_6n)

df6$JAR07_WOA <- (df6$ESTTASK2_7n-df6$ESTTASK1_7n)/(df6$est2_7_advicen-df6$ESTTASK1_7n)

df6$JAR08_WOA <- (df6$ESTTASK2_8n-df6$ESTTASK1_8n)/(df6$est2_8_advicen-df6$ESTTASK1_8n)

df6$JAR09_WOA <- (df6$ESTTASK2_9n-df6$ESTTASK1_9n)/(df6$est2_9_advicen-df6$ESTTASK1_9n)

df6$JAR10_WOA <- (df6$ESTTASK2_10n-df6$ESTTASK1_10n)/(df6$est2_10_advicen-df6$ESTTASK1_10n)

df6$JAR11_WOA <- (df6$ESTTASK2_11n-df6$ESTTASK1_11n)/(df6$est2_11_advicen-df6$ESTTASK1_11n)

df6$JAR12_WOA <- (df6$ESTTASK2_12n-df6$ESTTASK1_12n)/(df6$est2_12_advicen-df6$ESTTASK1_12n)


```


# Create depression symptom severity scores
```{r}

# Check reliability of DASS

df6 <- ungroup(df6)

baseline_DASS_rel <- df6 %>% select(DASS3n, DASS5n, DASS10n, DASS13n, DASS16n, DASS17n, DASS21n)

alpha(baseline_DASS_rel) # raw_alpha: Cronbach’s α (values ≥ .7 or .8 indicate 
# good reliability; Kline (1999)) - all are > .8

df7 <- df6 %>%
  rowwise() %>%
  mutate(DASS = sum(c(DASS3n, DASS5n, DASS10n, DASS13n, DASS16n, DASS17n, DASS21n), na.rm=T))

### Add depressive symptom category

df7$DASS_SEVERITY<- dplyr::case_when (df7$DASS <= 4 ~ 'NORMAL',
                                df7$DASS <= 6 ~ 'MILD',
                                df7$DASS <= 10 ~ 'MODERATE',
                                df7$DASS <= 13 ~ 'SEVERE',
                                df7$DASS >= 14 ~ 'EXTREMELY_SEVERE')

df7$AGEGROUP <- factor(df7$AGEGROUP, levels = c("YOUNG", "MIDDLE", "OLDER"))

df7$DASS_SEVERITY <- factor(df7$DASS_SEVERITY, levels = c("NORMAL", "MILD", "MODERATE", "SEVERE", "ESTREMELY_SEVERE"))

my_summary <- df7 %>%
  count(DASS_SEVERITY, AGEGROUP, sort = TRUE) 

```


# Sum together fluid IQ and number scores
```{r}

df7 <- df7 %>% 
  rowwise() %>%
  mutate(FLUIDIQ = sum(c(ls_7n, ls_8n, ls_9n, ls_10n, ls_11n, ls_12n, ls_13n, ls_14n,
                         ls_15n, ls_16n), na.rm=T))

df7 <- df7 %>% 
  rowwise() %>% 
  mutate(NUMIQ = sum(c(ns_9n, ns_10n, ns_11n, ns_12n, ns_13n, ns_14n, ns_15n, ns_16n,
                       ns_17n, ns_18n, ns_19n, ns_20n, ns_21n, ns_22n, ns_23n), na.rm=T))

## Create average score for fluid IQ

df7 <- df7 %>% 
  rowwise() %>% 
  mutate(AVFLUIDIQ = mean(c(FLUIDIQ, NUMIQ)))

```


# Remove WOA values smaller than -1.3 or larger than 1.3
```{r}
# Get total count of WOA values

countwoa <- df6 %>% 
  get_summary_stats(JAR01_WOA, JAR02_WOA, JAR03_WOA, JAR04_WOA, JAR05_WOA,
                    JAR06_WOA, JAR07_WOA, JAR08_WOA, JAR09_WOA, JAR10_WOA,
                    JAR11_WOA, JAR12_WOA, type = "common")

sum(countwoa$n) # 1864

## Remove from practice trials

df7 <- df7 %>%
  mutate(PRAC01_WOA = ifelse(PRAC01_WOA > 1.3|PRAC01_WOA < -1.3, as.integer(NA),PRAC01_WOA))
  
df7 <- df7 %>%
  mutate(PRAC02_WOA = ifelse(PRAC02_WOA > 1.3|PRAC02_WOA < -1.3, as.integer(NA),PRAC02_WOA))

df7 <- df7 %>%
  mutate(PRAC03_WOA = ifelse(PRAC03_WOA > 1.3|PRAC03_WOA < -1.3, as.integer(NA),PRAC03_WOA))


## Actual trials

df7 <- df7 %>%
  mutate(JAR01_WOA = ifelse(JAR01_WOA > 1.3|JAR01_WOA < -1.3, as.integer(NA),JAR01_WOA))

df7 <- df7 %>%
  mutate(JAR02_WOA = ifelse(JAR02_WOA > 1.3|JAR02_WOA < -1.3, as.integer(NA),JAR02_WOA))

df7 <- df7 %>%
  mutate(JAR03_WOA = ifelse(JAR03_WOA > 1.3|JAR03_WOA < -1.3, as.integer(NA),JAR03_WOA))

df7 <- df7 %>%
  mutate(JAR04_WOA = ifelse(JAR04_WOA > 1.3|JAR04_WOA < -1.3, as.integer(NA),JAR04_WOA))

df7 <- df7 %>%
  mutate(JAR05_WOA = ifelse(JAR05_WOA > 1.3|JAR05_WOA < -1.3, as.integer(NA),JAR05_WOA))

df7 <- df7 %>%
  mutate(JAR06_WOA = ifelse(JAR06_WOA > 1.3|JAR06_WOA < -1.3, as.integer(NA),JAR06_WOA))

df7 <- df7 %>%
  mutate(JAR07_WOA = ifelse(JAR07_WOA > 1.3|JAR07_WOA < -1.3, as.integer(NA),JAR07_WOA))

df7 <- df7 %>%
  mutate(JAR08_WOA = ifelse(JAR08_WOA > 1.3|JAR08_WOA < -1.3, as.integer(NA),JAR08_WOA))

df7 <- df7 %>%
  mutate(JAR09_WOA = ifelse(JAR09_WOA > 1.3|JAR09_WOA < -1.3, as.integer(NA),JAR09_WOA))

df7 <- df7 %>%
  mutate(JAR10_WOA = ifelse(JAR10_WOA > 1.3|JAR10_WOA < -1.3, as.integer(NA),JAR10_WOA))

df7 <- df7 %>%
  mutate(JAR11_WOA = ifelse(JAR11_WOA > 1.3|JAR11_WOA < -1.3, as.integer(NA),JAR11_WOA))

df7 <- df7 %>%
  mutate(JAR12_WOA = ifelse(JAR12_WOA > 1.3|JAR12_WOA < -1.3, as.integer(NA),JAR12_WOA))

## Get NA counts

### Number of NAs for each age group

nacount2 <- df7 %>%
  group_by(AGEGROUP) %>%  
  select(AGEGROUP, JAR01_WOA, JAR02_WOA, JAR03_WOA, JAR04_WOA, JAR05_WOA,
         JAR06_WOA, JAR07_WOA, JAR08_WOA, JAR09_WOA, JAR10_WOA,
         JAR11_WOA, JAR12_WOA) %>% # replace to your needs
  summarise_all(funs(sum(is.na(.))))

df7 %>% ungroup()

nacount2young <- subset(nacount2, AGEGROUP=="YOUNG")

sum(nacount2young$JAR01_WOA, nacount2young$JAR02_WOA, nacount2young$JAR03_WOA, nacount2young$JAR04_WOA, 
      nacount2young$JAR05_WOA, nacount2young$JAR06_WOA, nacount2young$JAR07_WOA, nacount2young$JAR08_WOA, 
      nacount2young$JAR09_WOA, nacount2young$JAR10_WOA, nacount2young$JAR11_WOA, nacount2young$JAR12_WOA)

# 55 NA for young (-1 people that would be NA due to being advice match removals)

55-1 

54/1864 # 3% for young

nacount2midd <- subset(nacount2, AGEGROUP=="MIDDLE")

sum(nacount2midd$JAR01_WOA, nacount2midd$JAR02_WOA, nacount2midd$JAR03_WOA, nacount2midd$JAR04_WOA, 
      nacount2midd$JAR05_WOA, nacount2midd$JAR06_WOA, nacount2midd$JAR07_WOA, nacount2midd$JAR08_WOA, 
      nacount2midd$JAR09_WOA, nacount2midd$JAR10_WOA, nacount2midd$JAR11_WOA, nacount2midd$JAR12_WOA)

# 62 NA for middle-aged (-4 people that were NA due to being advice match removals)

62-4

58/1864 # 3% for middle-aged

nacount2older <- subset(nacount2, AGEGROUP=="OLDER")

sum(nacount2older$JAR01_WOA, nacount2older$JAR02_WOA, nacount2older$JAR03_WOA, nacount2older$JAR04_WOA, 
      nacount2older$JAR05_WOA, nacount2older$JAR06_WOA, nacount2older$JAR07_WOA, nacount2older$JAR08_WOA, 
      nacount2older$JAR09_WOA, nacount2older$JAR10_WOA, nacount2older$JAR11_WOA, nacount2older$JAR12_WOA)

# 48 NA for older  (-3 people that were NA due to being advice match removals)

48-3

45/1864 # 2% for older adults

```


# Get M and SD for each age groups WOA values
## Get outliers from Young practice jars
```{r}

summarystats_jars_prac <- df7 %>% 
  group_by(AGEGROUP) %>%
  get_summary_stats(PRAC01_WOA, PRAC02_WOA, PRAC03_WOA, type = "mean_sd")

df7 %>% ungroup()

## Split into age groups
young <- subset(df7, AGEGROUP == "YOUNG")

middle <- subset(df7, AGEGROUP == "MIDDLE")

older <- subset(df7, AGEGROUP == "OLDER")

## keep getting an error - see if it happens on a dummy data frame.

# dummydf <- data.frame(id = c(1, 2, 3, 4, 5, 6, 7, 8, 9),
                     # woa = c(0.8, 0.8, -0.5, 1, -0.3, 0.3, -0.09, NA, NA))

# dummydf <- dummydf %>% 
 # rowwise(woa) %>% mutate(woa = ifelse(woa < -0.1, "less", woa))

## got the same error

## Check structure of the data

# structure(dummydf)

# dummydf$woa <- as.numeric(as.character(dummydf$woa))

# dummydf <- dummydf %>% 
  # rowwise(woa) %>% mutate(woa = ifelse(woa < -0.1, -100, woa)) ### This fixes it - I believe the error was to do with trying
### to replace the value with a word (character)


## Young - practice jars.

## Young prac jar 1 M + 3*SD

0.840 + (3*0.307)

# 1.761

## Young prac Jar 1 M - 3*SD

0.840 - (3*0.307)

# -0.081

young <- young %>%
  mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA > 1.761, 100, PRAC01_WOA)),
         PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA < -0.081, -100, PRAC01_WOA))) # 1 outlier


## Young prac jar 2 M + 3*SD

0.814 + (3*0.344)

# 1.846

## Young prac jar 2 M - 3*SD

0.814 - (3*0.344)

# -0.218

young <- young %>%
  mutate(PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                             ifelse(PRAC02_WOA > 1.846, 100, PRAC02_WOA)),
         PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                             ifelse(PRAC02_WOA < -0.218, -100, PRAC02_WOA))) # No outliers


## Young prac jar 3 M + 3*SD

0.798 + (3*0.388)

# 1.962

## Young prac jar 3 M - 3*SD

0.798 - (3*0.388)

# -0.366

young <- young %>%
  mutate(PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA > 1.962, 100, PRAC03_WOA)),
         PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA < -0.366, -100, PRAC03_WOA))) # No outliers


## Take out any outliers to prep for getting new Ms and SDs
# young$PRAC01_WOA_OUTLIER <- young %>% 
#  rowwise(PRAC01_WOA) %>% mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
#                                                 ifelse(PRAC01_WOA < 100, PRAC01_WOA, is.integer(NA)),
#                                                 ifelse(PRAC01_WOA > -100, PRAC01_WOA, is.integer(NA))))


## The above code doesn't work properly 

## Create new df without the outliers

young_exl_out <- select(young, PRAC01_WOA, PRAC02_WOA, PRAC03_WOA)

young_exl_out <- young_exl_out %>%
  mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA == 100 |PRAC01_WOA == -100, as.integer(NA), PRAC01_WOA)))

youngmsd <- young_exl_out %>% 
  get_summary_stats(PRAC01_WOA, PRAC02_WOA, PRAC03_WOA, type = "mean_sd")

## New young prac jar 1 M + 3*SDs

0.863 + (3*0.269)

# 1.67

## New young prac jar 1 M - 3*SDs

0.863 - (3*0.269)

# 0.056

# Replace the values taken

young <- young %>%
  mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA == 100, 1.67, PRAC01_WOA)),
         PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA == -100, 0.056, PRAC01_WOA)))


```


## Outliers from middle aged group practice jars
```{r}
## Middle - practice jars.

## Middle prac jar 1 M + 3*SD

0.801 + (3*0.346)

# 1.839

## Middle prac Jar 1 M - 3*SD

0.801 - (3*0.346)

# -0.237

middle <- middle %>%
  mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA > 1.839, 100, PRAC01_WOA)),
         PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA < -0.237, -100, PRAC01_WOA))) ## No outliers



## Middle prac jar 2 M + 3*SD

0.839 + (3*0.304)

# 1.751

## Middle prac Jar 2 M - 3*SD

0.839 - (3*0.304)

# -0.073

middle <- middle %>%
  mutate(PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                             ifelse(PRAC02_WOA > 1.751, 100, PRAC02_WOA)),
         PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                             ifelse(PRAC02_WOA < -0.073, -100, PRAC02_WOA))) ## 1 Outlier



## Middle prac jar 3 M + 3*SD

0.769 + (3*0.342)

# 1.795

## Middle prac Jar 3 M - 3*SD

0.769 - (3*0.342)

# -0.257

middle <- middle %>%
  mutate(PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA > 1.795, 100, PRAC03_WOA)),
         PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA < -0.257, -100, PRAC03_WOA))) ## 1 outlier


## Create new df without the outliers

middle_exl_out <- select(middle, PRAC01_WOA, PRAC02_WOA, PRAC03_WOA)

middle_exl_out <- middle_exl_out %>%
  mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA == 100 |PRAC01_WOA == -100, as.integer(NA), PRAC01_WOA)),
         PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                             ifelse(PRAC02_WOA == 100 | PRAC02_WOA == -100, as.integer(NA), PRAC02_WOA)),
         PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA == 100 | PRAC03_WOA == -100, as.integer(NA), PRAC03_WOA)))

middlemsd <- middle_exl_out %>% 
  get_summary_stats(PRAC01_WOA, PRAC02_WOA, PRAC03_WOA, type = "mean_sd")

## New middle prac jar 2 M + 3*SDs

0.859 + (3*0.272)

# 1.675

## New middle prac jar 2 M - 3*SDs

0.859 - (3*0.272)

# 0.043

## New middle prac jar 3 M + 3*SDs

0.792 + (3*0.306)

# 1.71

## New middle prac jar 3 M - 3*SDs

0.792 - (3*0.306)

# -0.126


# Replace the values taken

middle <- middle %>%
  mutate(PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                             ifelse(PRAC02_WOA == 100, 1.675, PRAC02_WOA)),
         PRAC02_WOA= ifelse(is.na(PRAC02_WOA), NA,
                             ifelse(PRAC02_WOA == -100, 0.043, PRAC02_WOA)),
         PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA == 100, 1.71, PRAC03_WOA)),
         PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA == -100, -0.126, PRAC03_WOA)))


```


## Outliers from middle aged group practice jars

```{r}
older %>% ungroup()

## Older - practice jars.

## Older prac jar 1 M + 3*SD

0.690 + (3*0.391)

# 1.863

## Older prac Jar 1 M - 3*SD

0.690 - (3*0.391)

# -0.483

older <- older %>%
  mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA > 1.863, 100, PRAC01_WOA)),
         PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA < -0.483, -100, PRAC01_WOA))) ## 1 outlier


## Older prac jar 2 M + 3*SD

0.844 + (3*0.272)

# 1.66

## Older prac Jar 2 M - 3*SD

0.844 - (3*0.272)

# 0.028

older <- older %>%
  mutate(PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                             ifelse(PRAC02_WOA > 1.66, 100, PRAC02_WOA)),
         PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                             ifelse(PRAC02_WOA < 0.028, -100, PRAC02_WOA))) ## No outliers


## Older prac jar 3 M + 3*SD

0.700 + (3*0.445)

# 2.035

## Older prac Jar 3 M - 3*SD

0.700 - (3*0.445)

# -0.635

older <- older %>%
  mutate(PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA > 2.035, 100, PRAC03_WOA)),
         PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA < -0.635, -100, PRAC03_WOA))) ## 1 outlier



## Create new df without the outliers

older_exl_out <- select(older, PRAC01_WOA, PRAC02_WOA, PRAC03_WOA)

older_exl_out <- older_exl_out %>%
  mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA == 100 |PRAC01_WOA == -100, as.integer(NA), PRAC01_WOA)),
         PRAC02_WOA = ifelse(is.na(PRAC02_WOA), NA,
                             ifelse(PRAC02_WOA == 100 | PRAC02_WOA == -100, as.integer(NA), PRAC02_WOA)),
         PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA == 100 | PRAC03_WOA == -100, as.integer(NA), PRAC03_WOA)))

oldermsd <- older_exl_out %>% 
  get_summary_stats(PRAC01_WOA, PRAC02_WOA, PRAC03_WOA, type = "mean_sd")

## New older prac jar 1 M + 3*SDs

0.712 + (3*0.357)

# 1.783

## New older prac jar 1 M - 3*SDs

0.712 - (3*0.357)

# -0.359

## New older prac jar 3 M + 3*SDs

0.739 + (3*0.353)

# 1.798

## New older prac jar 3 M - 3*SDs

0.739 - (3*0.353)

# -0.32


# Replace the values taken

older <- older %>%
  mutate(PRAC01_WOA = ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA == 100, 1.783, PRAC01_WOA)),
         PRAC01_WOA= ifelse(is.na(PRAC01_WOA), NA,
                             ifelse(PRAC01_WOA == -100, -0.359, PRAC01_WOA)),
         PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA == 100, 1.798, PRAC03_WOA)),
         PRAC03_WOA = ifelse(is.na(PRAC03_WOA), NA,
                             ifelse(PRAC03_WOA == -100, -0.32, PRAC03_WOA)))

```


## Outliers for young adults 12 jars
```{r}
summarystats_jars <- df7 %>% 
  group_by(AGEGROUP) %>%
  get_summary_stats(JAR01_WOA, JAR02_WOA, JAR03_WOA, JAR04_WOA,
                    JAR05_WOA, JAR06_WOA, JAR07_WOA, JAR08_WOA,
                    JAR09_WOA, JAR10_WOA, JAR11_WOA, JAR12_WOA, type = "mean_sd")
df7  %>% ungroup()

summarystats_jars$M_PLUS_3SD <- summarystats_jars$mean + (3*summarystats_jars$sd)

summarystats_jars$M_MINUS_3SD <- summarystats_jars$mean - (3*summarystats_jars$sd)

young %>% ungroup()

## Get young jar 1 outliers

young <- young %>%
  mutate(JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA > 0.933, 100, JAR01_WOA)),
         JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA < -1.737, -100, JAR01_WOA))) ## 1 outlier


## Get young jar 2 outliers

young <- young %>%
  mutate(JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA > 2.083, 100, JAR02_WOA)),
         JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA < -0.731, -100, JAR02_WOA))) ## 1 outlier


## Get young jar 3 outliers

young <- young %>%
  mutate(JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA > 1.993, 100, JAR03_WOA)),
         JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA < -0.527, -100, JAR03_WOA))) ## No outliers


## Get young jar 4 outliers

young <- young %>%
  mutate(JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA > 4.585, 100, JAR04_WOA)),
         JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA < -3.485, -100, JAR04_WOA))) ## 1 outlier


## Get young jar 5 outliers

young <- young %>%
  mutate(JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA > 1.838, 100, JAR05_WOA)),
         JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA < -0.550, -100, JAR05_WOA))) ## No outliers


## Get young jar 6 outliers

young <- young %>%
  mutate(JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA > 1.816, 100, JAR06_WOA)),
         JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA < -0.338, -100, JAR06_WOA))) ## No outliers

## Get young jar 7 outliers

young <- young %>%
  mutate(JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA > 1.831, 100, JAR07_WOA)),
         JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA < -0.365, -100, JAR07_WOA))) ## No outliers


## Get young jar 8 outliers

young <- young %>%
  mutate(JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA > 1.880, 100, JAR08_WOA)),
         JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA < -0.718, -100, JAR08_WOA))) ## No outliers


## Get young jar 9 outliers

young <- young %>%
  mutate(JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA > 1.859, 100, JAR09_WOA)),
         JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA < -0.481, -100, JAR09_WOA))) ## No outliers


## Get young jar 10 outliers

young <- young %>%
  mutate(JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA > 1.870, 100, JAR10_WOA)),
         JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA < -0.464, -100, JAR10_WOA))) ## 1 outlier


## Get young jar 11 outliers

young <- young %>%
  mutate(JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA > 1.961, 100, JAR11_WOA)),
         JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA < -0.661, -100, JAR11_WOA))) ## No outliers


## Get young jar 12 outliers

young <- young %>%
  mutate(JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA > 2.140, 100, JAR12_WOA)),
         JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA < -0.698, -100, JAR12_WOA))) ## 1 outlier


## Create new df without the outliers

young_jars_exl_out <- select(young, JAR01_WOA, JAR02_WOA, JAR03_WOA, JAR04_WOA,
                             JAR05_WOA, JAR06_WOA, JAR07_WOA, JAR08_WOA,
                             JAR09_WOA, JAR10_WOA, JAR11_WOA, JAR12_WOA)

young_jars_exl_out <- young_jars_exl_out %>%
  mutate(JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA == 100 |JAR01_WOA == -100, as.integer(NA), JAR01_WOA)),
        JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA == 100 | JAR02_WOA == -100, as.integer(NA), JAR02_WOA)),
        JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA == 100 | JAR03_WOA == -100, as.integer(NA), JAR03_WOA)),
        JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA == 100 | JAR04_WOA == -100, as.integer(NA), JAR04_WOA)),
        JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA == 100 | JAR05_WOA == -100, as.integer(NA), JAR05_WOA)),
        JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA == 100 | JAR06_WOA == -100, as.integer(NA), JAR06_WOA)),
        JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA == 100 | JAR07_WOA == -100, as.integer(NA), JAR07_WOA)),
        JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA == 100 | JAR08_WOA == -100, as.integer(NA), JAR08_WOA)),
        JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA == 100 | JAR09_WOA == -100, as.integer(NA), JAR09_WOA)),
        JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA == 100 | JAR10_WOA == -100, as.integer(NA), JAR10_WOA)),
        JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA == 100 | JAR11_WOA == -100, as.integer(NA), JAR11_WOA)),
        JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA == 100 | JAR12_WOA == -100, as.integer(NA), JAR12_WOA)))

youngmsd_jars <- young_jars_exl_out %>% 
  get_summary_stats(JAR01_WOA, JAR02_WOA, JAR03_WOA, JAR04_WOA,
                             JAR05_WOA, JAR06_WOA, JAR07_WOA, JAR08_WOA,
                             JAR09_WOA, JAR10_WOA, JAR11_WOA, JAR12_WOA, type = "mean_sd")

youngmsd_jars$M_PLUS_3SD <- youngmsd_jars$mean + (3*youngmsd_jars$sd)

youngmsd_jars$M_MINUS_3SD <- youngmsd_jars$mean - (3*youngmsd_jars$sd)


youngout <- subset(young, AGEGROUP=="YOUNG")

## Get sum of outliers for young group for jars

sum(young$JAR01_WOA >= 100|young$JAR01_WOA <= -100|young$JAR02_WOA >= 100|
      young$JAR02_WOA== -100|young$JAR03_WOA >= 100|young$JAR03_WOA <= -100|
      young$JAR04_WOA >= 100|young$JAR04_WOA <= -100|young$JAR05_WOA >= 100|
      young$JAR05_WOA <= -100|young$JAR06_WOA >= 100|young$JAR06_WOA <= -100|
      young$JAR07_WOA >= 100|young$JAR07_WOA <= -100|young$JAR08_WOA >= 100|
      young$JAR08_WOA <= -100|young$JAR09_WOA >= 100|young$JAR09_WOA <= -100|
      young$JAR10_WOA >= 100|young$JAR10_WOA <= -100|young$JAR11_WOA >= 100|
      young$JAR11_WOA <= -100|young$JAR12_WOA >= 100|young$JAR12_WOA <= -100, na.rm=TRUE)

## 5 data points adjusted for young adult group

# Replace the values taken

young <- young %>%
  mutate(JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA == 100, 0.617, JAR01_WOA)),
         JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA == -100, -1.519, JAR01_WOA)),
         JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA == 100, 1.836, JAR02_WOA)),
         JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA == -100, -0.396, JAR02_WOA)),
         JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA == 100, 1.993, JAR03_WOA)),
         JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA == -100, -0.527, JAR03_WOA)),
         JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA == 100, 2.044, JAR04_WOA)),
         JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA == -100, -0.572, JAR04_WOA)),
         JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA == 100, 1.838, JAR05_WOA)),
         JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA == -100, -0.550, JAR05_WOA)),
         JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA == 100, 1.816, JAR06_WOA)),
         JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA == -100, -0.338, JAR06_WOA)),
         JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA == 100, 1.831, JAR07_WOA)),
         JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA == -100, -0.365, JAR07_WOA)),
         JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA == 100, 1.880, JAR08_WOA)),
         JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA == -100, -0.718, JAR08_WOA)),
         JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA == 100, 1.859, JAR09_WOA)),
         JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA == -100, -0.481, JAR09_WOA)),
         JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA == 100, 1.770, JAR10_WOA)),
         JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA == -100, -0.306, JAR10_WOA)),
         JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA == 100, 1.961, JAR11_WOA)),
         JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA == -100, -0.661, JAR11_WOA)),
         JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA == 100, 1.862, JAR12_WOA)),
         JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA == -100, -0.328, JAR12_WOA)))

```

## Outliers for middle-aged adults 12 jars
```{r}

middle %>% ungroup()

## Get middle jar 1 outliers

middle <- middle %>%
  mutate(JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA > 1.067, 100, JAR01_WOA)),
         JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA < -2.329, -100, JAR01_WOA))) ## No outliers


## Get middle jar 2 outliers

middle <- middle %>%
  mutate(JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA > 1.905, 100, JAR02_WOA)),
         JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA < -0.393, -100, JAR02_WOA))) ## No outliers


## Get middle jar 3 outliers

middle <- middle %>%
  mutate(JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA > 1.896, 100, JAR03_WOA)),
         JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA < -0.330, -100, JAR03_WOA))) ## No outliers


## Get middle jar 4 outliers

middle <- middle %>%
  mutate(JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA > 5.644, 100, JAR04_WOA)),
         JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA < -4.484, -100, JAR04_WOA))) ## 1 outlier


## Get middle jar 5 outliers

middle <- middle %>%
  mutate(JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA > 1.994, 100, JAR05_WOA)),
         JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA < -0.490, -100, JAR05_WOA))) ## No outliers

## Get middle jar 6 outliers

middle <- middle %>%
  mutate(JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA > 2.108, 100, JAR06_WOA)),
         JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA < -0.700, -100, JAR06_WOA))) ## 1 outlier


## Get middle jar 7 outliers

middle <- middle %>%
  mutate(JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA > 1.954, 100, JAR07_WOA)),
         JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA < -0.602, -100, JAR07_WOA))) ## 1 outlier

## Get middle jar 8 outliers

middle <- middle %>%
  mutate(JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA > 2.111, 100, JAR08_WOA)),
         JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA < -0.829, -100, JAR08_WOA))) ## 1 outlier

## Get middle jar 9 outliers

middle <- middle %>%
  mutate(JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA > 1.967, 100, JAR09_WOA)),
         JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA < -0.451, -100, JAR09_WOA))) ## 1 outlier

## Get middle jar 10 outliers
middle <- middle %>%
  mutate(JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA > 2.121, 100, JAR10_WOA)),
         JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA < -0.729, -100, JAR10_WOA))) ## 1 outlier

## Get middle jar 11 outliers
middle <- middle %>%
  mutate(JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA > 1.922, 100, JAR11_WOA)),
         JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA < -0.358, -100, JAR11_WOA))) ## No outliers

## Get middle jar 12 outliers
middle <- middle %>%
  mutate(JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA > 1.892, 100, JAR12_WOA)),
         JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA < -0.406, -100, JAR12_WOA))) ## No outliers

## Create new df without the outliers

middle_jars_exl_out <- select(middle, JAR01_WOA, JAR02_WOA, JAR03_WOA, JAR04_WOA,
                             JAR05_WOA, JAR06_WOA, JAR07_WOA, JAR08_WOA,
                             JAR09_WOA, JAR10_WOA, JAR11_WOA, JAR12_WOA)

middle_jars_exl_out <- middle_jars_exl_out %>%
  mutate(JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA == 100 |JAR01_WOA == -100, as.integer(NA), JAR01_WOA)),
        JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA == 100 | JAR02_WOA == -100, as.integer(NA), JAR02_WOA)),
        JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA == 100 | JAR03_WOA == -100, as.integer(NA), JAR03_WOA)),
        JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA == 100 | JAR04_WOA == -100, as.integer(NA), JAR04_WOA)),
        JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA == 100 | JAR05_WOA == -100, as.integer(NA), JAR05_WOA)),
        JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA == 100 | JAR06_WOA == -100, as.integer(NA), JAR06_WOA)),
        JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA == 100 | JAR07_WOA == -100, as.integer(NA), JAR07_WOA)),
        JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA == 100 | JAR08_WOA == -100, as.integer(NA), JAR08_WOA)),
        JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA == 100 | JAR09_WOA == -100, as.integer(NA), JAR09_WOA)),
        JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA == 100 | JAR10_WOA == -100, as.integer(NA), JAR10_WOA)),
        JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA == 100 | JAR11_WOA == -100, as.integer(NA), JAR11_WOA)),
        JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA == 100 | JAR12_WOA == -100, as.integer(NA), JAR12_WOA)))

middlemsd_jars <- middle_jars_exl_out %>% 
  get_summary_stats(JAR01_WOA, JAR02_WOA, JAR03_WOA, JAR04_WOA,
                             JAR05_WOA, JAR06_WOA, JAR07_WOA, JAR08_WOA,
                             JAR09_WOA, JAR10_WOA, JAR11_WOA, JAR12_WOA, type = "mean_sd")

middlemsd_jars$M_PLUS_3SD <- middlemsd_jars$mean + (3*middlemsd_jars$sd)

middlemsd_jars$M_MINUS_3SD <- middlemsd_jars$mean - (3*middlemsd_jars$sd)


## Get sum of outliers for young group for jars

sum(middle$JAR01_WOA <= -100|middle$JAR01_WOA >= 100| 
      middle$JAR02_WOA <= -100|middle$JAR02_WOA >= 100|
      middle$JAR03_WOA <= -100|middle$JAR03_WOA >= 100|
      middle$JAR04_WOA <= -100|middle$JAR04_WOA >= 100|
      middle$JAR05_WOA <= -100|middle$JAR05_WOA >= 100|
      middle$JAR06_WOA <= -100|middle$JAR06_WOA >= 100|
      middle$JAR07_WOA <= -100|middle$JAR07_WOA >= 100|
      middle$JAR08_WOA <= -100|middle$JAR08_WOA >= 100|
      middle$JAR09_WOA <= -100|middle$JAR09_WOA >= 100|
      middle$JAR10_WOA <= -100|middle$JAR10_WOA >= 100|
      middle$JAR11_WOA <= -100|middle$JAR11_WOA >= 100|
      middle$JAR12_WOA <= -100,middle$JAR12_WOA >= 100, na.rm=TRUE)

## It says 4 but I thought there were 6...? Need to investigate what is going wrong.

# Replace the values taken

middle <- middle %>%
  mutate(JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA == 100, 1.067, JAR01_WOA)),
         JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA == -100, -2.329, JAR01_WOA)),
         JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA == 100, 1.905, JAR02_WOA)),
         JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA == -100, -0.393, JAR02_WOA)),
         JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA == 100, 1.896, JAR03_WOA)),
         JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA == -100, -0.330, JAR03_WOA)),
         JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA == 100, 2.377, JAR04_WOA)),
         JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA == -100, -0.779, JAR04_WOA)),
         JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA == 100, 1.994, JAR05_WOA)),
         JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA == -100, -0.490, JAR05_WOA)),
         JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA == 100, 1.989, JAR06_WOA)),
         JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA == -100, -0.519, JAR06_WOA)),
         JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA == 100, 1.862, JAR07_WOA)),
         JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA == -100, -0.454, JAR07_WOA)),
         JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA == 100, 1.904, JAR08_WOA)),
         JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA == -100, -0.538, JAR08_WOA)),
         JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA == 100, 1.885, JAR09_WOA)),
         JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA == -100, -0.323, JAR09_WOA)),
         JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA == 100, 1.983, JAR10_WOA)),
         JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA == -100, -0.525, JAR10_WOA)),
         JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA == 100, 1.922, JAR11_WOA)),
         JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA == -100, -0.358, JAR11_WOA)),
         JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA == 100, 1.892, JAR12_WOA)),
         JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA == -100, -0.406, JAR12_WOA)))

```


## Outliers for older adults 12 jars
```{r}

older %>% ungroup()

## Get older jar 1 outliers

older <- older %>%
  mutate(JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA > 0.448, 100, JAR01_WOA)),
         JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA < -1.670, -100, JAR01_WOA))) ## No outliers

## Get older jar 2 outliers

older <- older %>%
  mutate(JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA > 1.630, 100, JAR02_WOA)),
         JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA < -0.092, -100, JAR02_WOA))) ## No outliers

## Get older jar 3 outliers

older <- older %>%
  mutate(JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA > 1.780, 100, JAR03_WOA)),
         JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA < -0.380, -100, JAR03_WOA))) ## No outliers

## Get older jar 4 outliers

older <- older %>%
  mutate(JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA > 1.855, 100, JAR04_WOA)),
         JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA < -0.503, -100, JAR04_WOA))) ## No outliers

## Get older jar 5 outliers

older <- older %>%
  mutate(JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA > 1.678, 100, JAR05_WOA)),
         JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA < -0.350, -100, JAR05_WOA))) ## No outliers

## Get older jar 6 outliers

older <- older %>%
  mutate(JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA > 1.863, 100, JAR06_WOA)),
         JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA < -0.525, -100, JAR06_WOA))) ## 1 outlier


## Get older jar 7 outliers

older <- older %>%
  mutate(JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA > 1.641, 100, JAR07_WOA)),
         JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA < -0.351, -100, JAR07_WOA))) ## No outliers

## Get older jar 8 outliers

older <- older %>%
  mutate(JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA > 1.848, 100, JAR08_WOA)),
         JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA < -0.630, -100, JAR08_WOA))) ## No outliers

## Get older jar 9 outliers

older <- older %>%
  mutate(JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA > 1.802, 100, JAR09_WOA)),
         JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA < -0.430, -100, JAR09_WOA))) ## No outliers

## Get older jar 10 outliers

older <- older %>%
  mutate(JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA > 1.786, 100, JAR10_WOA)),
         JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA < -0.386, -100, JAR10_WOA))) ## No outliers

## Get older jar 11 outliers

older <- older %>%
  mutate(JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA > 1.727, 100, JAR11_WOA)),
         JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA < -0.367, -100, JAR11_WOA))) ## No outliers

## Get older jar 12 outliers

older <- older %>%
  mutate(JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA > 1.808, 100, JAR12_WOA)),
         JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA < -0.310, -100, JAR12_WOA))) ## 1 outlier


## Create new df without the outliers

older_jars_exl_out <- select(older, JAR01_WOA, JAR02_WOA, JAR03_WOA, JAR04_WOA,
                             JAR05_WOA, JAR06_WOA, JAR07_WOA, JAR08_WOA,
                             JAR09_WOA, JAR10_WOA, JAR11_WOA, JAR12_WOA)

older_jars_exl_out <- older_jars_exl_out %>%
  mutate(JAR01_WOA = ifelse(is.na(JAR01_WOA), NA,
                             ifelse(JAR01_WOA == 100 |JAR01_WOA == -100, as.integer(NA), JAR01_WOA)),
        JAR02_WOA = ifelse(is.na(JAR02_WOA), NA,
                             ifelse(JAR02_WOA == 100 | JAR02_WOA == -100, as.integer(NA), JAR02_WOA)),
        JAR03_WOA = ifelse(is.na(JAR03_WOA), NA,
                             ifelse(JAR03_WOA == 100 | JAR03_WOA == -100, as.integer(NA), JAR03_WOA)),
        JAR04_WOA = ifelse(is.na(JAR04_WOA), NA,
                             ifelse(JAR04_WOA == 100 | JAR04_WOA == -100, as.integer(NA), JAR04_WOA)),
        JAR05_WOA = ifelse(is.na(JAR05_WOA), NA,
                             ifelse(JAR05_WOA == 100 | JAR05_WOA == -100, as.integer(NA), JAR05_WOA)),
        JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA == 100 | JAR06_WOA == -100, as.integer(NA), JAR06_WOA)),
        JAR07_WOA = ifelse(is.na(JAR07_WOA), NA,
                             ifelse(JAR07_WOA == 100 | JAR07_WOA == -100, as.integer(NA), JAR07_WOA)),
        JAR08_WOA = ifelse(is.na(JAR08_WOA), NA,
                             ifelse(JAR08_WOA == 100 | JAR08_WOA == -100, as.integer(NA), JAR08_WOA)),
        JAR09_WOA = ifelse(is.na(JAR09_WOA), NA,
                             ifelse(JAR09_WOA == 100 | JAR09_WOA == -100, as.integer(NA), JAR09_WOA)),
        JAR10_WOA = ifelse(is.na(JAR10_WOA), NA,
                             ifelse(JAR10_WOA == 100 | JAR10_WOA == -100, as.integer(NA), JAR10_WOA)),
        JAR11_WOA = ifelse(is.na(JAR11_WOA), NA,
                             ifelse(JAR11_WOA == 100 | JAR11_WOA == -100, as.integer(NA), JAR11_WOA)),
        JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA == 100 | JAR12_WOA == -100, as.integer(NA), JAR12_WOA)))

oldermsd_jars <- older_jars_exl_out %>% 
  get_summary_stats(JAR01_WOA, JAR02_WOA, JAR03_WOA, JAR04_WOA,
                             JAR05_WOA, JAR06_WOA, JAR07_WOA, JAR08_WOA,
                             JAR09_WOA, JAR10_WOA, JAR11_WOA, JAR12_WOA, type = "mean_sd")

oldermsd_jars$M_PLUS_3SD <- oldermsd_jars$mean + (3*oldermsd_jars$sd)

oldermsd_jars$M_MINUS_3SD <- oldermsd_jars$mean - (3*oldermsd_jars$sd)


## Get sum of outliers for young group for jars

sum(older$JAR01_WOA == -100|older$JAR02_WOA == -100|older$JAR03_WOA == -100|
      older$JAR04_WOA == -100|older$JAR05_WOA == -100|older$JAR06_WOA == -100|
      older$JAR07_WOA == -100|older$JAR08_WOA == -100|older$JAR09_WOA == -100|
      older$JAR10_WOA == -100|older$JAR11_WOA == -100|older$JAR12_WOA == -100, na.rm=TRUE)

## 2 outliers adjusted for older adults

# Replace the values taken

older <- older %>%
  mutate(JAR06_WOA = ifelse(is.na(JAR06_WOA), NA,
                             ifelse(JAR06_WOA == -100, -0.329, JAR06_WOA)),
         JAR12_WOA = ifelse(is.na(JAR12_WOA), NA,
                             ifelse(JAR12_WOA == -100, -0.135, JAR12_WOA)))

```


# Find outliers for IQ and DASS for each age group
```{r}

## Young
## Get Ms and SDs

young %>% ungroup()

youngmsd_Qs <- young %>% 
  get_summary_stats(DASS, AVFLUIDIQ, PRE_CONFIDENCEn, POST_CONFIDENCEn,
                    PERCEIVED_ADVICE_ACCURACYn, type = "mean_sd")

## Get mean + 3*SDs and mean - 3*SDs

youngmsd_Qs$M_PLUS_3SD <- youngmsd_Qs$mean + (3*youngmsd_Qs$sd)

youngmsd_Qs$M_MINUS_3SD <- youngmsd_Qs$mean - (3*youngmsd_Qs$sd)


## Identify outliers from DASS

young <- young %>%
  mutate(DASS = ifelse(DASS > 25.236, 100, DASS),
         DASS = ifelse(DASS < -11.322, -100, DASS)) ## No outliers

## Identify outliers for Fluid IQ

young <- young %>%
  mutate(AVFLUIDIQ = ifelse(AVFLUIDIQ > 10.215, 100, AVFLUIDIQ),
         AVFLUIDIQ = ifelse(AVFLUIDIQ < -2.193, -100, AVFLUIDIQ)) ## No outliers

## Identify outliers for PRE_CONFIDENCE

young <- young %>%
  mutate(PRE_CONFIDENCEn = ifelse(PRE_CONFIDENCEn > 6.329, 100, PRE_CONFIDENCEn),
         PRE_CONFIDENCEn = ifelse(PRE_CONFIDENCEn < -0.457, -100, PRE_CONFIDENCEn)) ## No outliers

## Identify outliers for POST_CONFIDENCE

young <- young %>%
  mutate(POST_CONFIDENCEn = ifelse(POST_CONFIDENCEn > 6.579, 100, POST_CONFIDENCEn),
         POST_CONFIDENCEn = ifelse(POST_CONFIDENCEn < -0.153, -100, POST_CONFIDENCEn)) ## No outliers

## Identify outliers for perceived advice accuracy

young <- young %>%
  mutate(PERCEIVED_ADVICE_ACCURACYn = ifelse(PERCEIVED_ADVICE_ACCURACYn > 5.878, 100, PERCEIVED_ADVICE_ACCURACYn),
         PERCEIVED_ADVICE_ACCURACYn = ifelse(PERCEIVED_ADVICE_ACCURACYn < 1.228, -100, PERCEIVED_ADVICE_ACCURACYn)) ## No outliers

## Middle
## Get Ms and SDs

middle %>% ungroup()

middlemsd_Qs <- middle %>% 
  get_summary_stats(DASS, AVFLUIDIQ, PRE_CONFIDENCEn, POST_CONFIDENCEn,
                    PERCEIVED_ADVICE_ACCURACYn, type = "mean_sd")

## Get mean + 3*SDs and mean - 3*SDs

middlemsd_Qs$M_PLUS_3SD <- middlemsd_Qs$mean + (3*middlemsd_Qs$sd)

middlemsd_Qs$M_MINUS_3SD <- middlemsd_Qs$mean - (3*middlemsd_Qs$sd)

## Identify outliers from DASS

middle <- middle %>%
  mutate(DASS = ifelse(DASS > 22.048, 100, DASS),
         DASS = ifelse(DASS < -9.788, -100, DASS)) ## No outliers

## Identify outliers for Fluid IQ

middle <- middle %>%
  mutate(AVFLUIDIQ = ifelse(AVFLUIDIQ > 9.404, 100, AVFLUIDIQ),
         AVFLUIDIQ = ifelse(AVFLUIDIQ < -1.126, -100, AVFLUIDIQ)) ## No outliers

## Identify outliers for PRE_CONFIDENCE

middle <- middle %>%
  mutate(PRE_CONFIDENCEn = ifelse(PRE_CONFIDENCEn > 5.730, 100, PRE_CONFIDENCEn),
         PRE_CONFIDENCEn = ifelse(PRE_CONFIDENCEn < -0.174, -100, PRE_CONFIDENCEn)) ## No outliers

## Identify outliers for POST_CONFIDENCE

middle <- middle %>%
  mutate(POST_CONFIDENCEn = ifelse(POST_CONFIDENCEn > 6.285, 100, POST_CONFIDENCEn),
         POST_CONFIDENCEn = ifelse(POST_CONFIDENCEn < -0.063, -100, POST_CONFIDENCEn)) ## No outliers

## Identify outliers for perceived advice accuracy

middle <- middle %>%
  mutate(PERCEIVED_ADVICE_ACCURACYn = ifelse(PERCEIVED_ADVICE_ACCURACYn > 6.363, 100, PERCEIVED_ADVICE_ACCURACYn),
         PERCEIVED_ADVICE_ACCURACYn = ifelse(PERCEIVED_ADVICE_ACCURACYn < 0.045, -100, PERCEIVED_ADVICE_ACCURACYn)) ## No outliers


## Older
## Get Ms and SDs

older %>% ungroup()

oldermsd_Qs <- older %>% 
  get_summary_stats(DASS, AVFLUIDIQ, PRE_CONFIDENCEn, POST_CONFIDENCEn,
                    PERCEIVED_ADVICE_ACCURACYn, type = "mean_sd")

## Get mean + 3*SDs and mean - 3*SDs

oldermsd_Qs$M_PLUS_3SD <- oldermsd_Qs$mean + (3*oldermsd_Qs$sd)

oldermsd_Qs$M_MINUS_3SD <- oldermsd_Qs$mean - (3*oldermsd_Qs$sd)

## Identify outliers from DASS

older <- older %>%
  mutate(DASS = ifelse(DASS > 16.252, 100, DASS),
         DASS = ifelse(DASS < -10.142, -100, DASS)) ## 1 outlier

## Recalculate DASS M and SD without the outlier

older_exl_out_qs <- older %>% 
  mutate(DASS = ifelse(DASS == 100, as.integer(NA), DASS))

oldermsd_Qs_exl_out <- older_exl_out_qs %>% 
  get_summary_stats(DASS, type = "mean_sd")

## New mean + 3*SDs

oldermsd_Qs_exl_out$M_PLUS_3SD <- oldermsd_Qs_exl_out$mean + (3*oldermsd_Qs_exl_out$sd)


# Replace the DASS values taken

older <- older %>%
  mutate(DASS = ifelse(DASS == 100, 14.312, DASS))

## Identify outliers for Fluid IQ

older <- older %>%
  mutate(AVFLUIDIQ = ifelse(AVFLUIDIQ > 8.674, 100, AVFLUIDIQ),
         AVFLUIDIQ = ifelse(AVFLUIDIQ < -0.674, -100, AVFLUIDIQ)) ## No outliers

## Identify outliers for PRE_CONFIDENCE

older <- older %>%
  mutate(PRE_CONFIDENCEn = ifelse(PRE_CONFIDENCEn > 5.507, 100, PRE_CONFIDENCEn),
         PRE_CONFIDENCEn = ifelse(PRE_CONFIDENCEn < -0.343, -100, PRE_CONFIDENCEn)) ## No outliers

## Identify outliers for POST_CONFIDENCE

older <- older %>%
  mutate(POST_CONFIDENCEn = ifelse(POST_CONFIDENCEn > 5.898, 100, POST_CONFIDENCEn),
         POST_CONFIDENCEn = ifelse(POST_CONFIDENCEn < -0.516, -100, POST_CONFIDENCEn)) ## No outliers

## Identify outliers for perceived advice accuracy

older <- older %>%
  mutate(PERCEIVED_ADVICE_ACCURACYn = ifelse(PERCEIVED_ADVICE_ACCURACYn > 5.767, 100, PERCEIVED_ADVICE_ACCURACYn),
         PERCEIVED_ADVICE_ACCURACYn = ifelse(PERCEIVED_ADVICE_ACCURACYn < -0.131, -100, PERCEIVED_ADVICE_ACCURACYn)) ## No outliers

```


# Averages and Centering

```{r}
## Create average time for each P in practice sessions

## 1st Prac session

df7 <- df7 %>% 
  rowwise %>%
  mutate(AVG_TIME_PRAC_1 = mean(c(TIME_P1_1n, TIME_P1_2n, TIME_P1_3n)))

## 2nd Prac session

df7 <- df7 %>% 
  rowwise %>%
  mutate(AVG_TIME_PRAC_2 = mean(c(TIME_P2_1n, TIME_P2_2n, TIME_P2_3n)))

## Create average time for each P in 1st estimate trials

df8 <- df7 %>% 
  rowwise %>% 
  mutate(AVG_TIME_EST_1 = mean(c(TIME_ET1_1n, TIME_ET1_2n, TIME_ET1_3n, TIME_ET1_4n,
                      TIME_ET1_5n, TIME_ET1_6n, TIME_ET1_7n, TIME_ET1_8n,
                      TIME_ET1_9n, TIME_ET1_10n, TIME_ET1_11n, TIME_ET1_12n)))

df8 <- df8 %>% 
  rowwise %>% 
  mutate(AVG_TIME_EST_2 = mean(c(TIME_ET2_1n, TIME_ET2_2n, TIME_ET2_3n, TIME_ET2_4n,
                      TIME_ET2_5n, TIME_ET2_6n, TIME_ET2_7n, TIME_ET2_8n,
                      TIME_ET2_9n, TIME_ET2_10n, TIME_ET2_11n, TIME_ET2_12n)))

ungroup(df8)

## Grand Mean Center Age

df8 <- df8 %>% mutate(GMC_AGE = scale(AGEn, center = TRUE, scale = FALSE))
  
## Grand Mean Center Education

df9 <- df8 %>% mutate(GMC_EDU = scale(EDUn, scale = FALSE))

## Grand Mean Center HEALTH

df9 <- df9 %>% mutate(GMC_HEALTH = scale(CURRENT_HEALTHn, scale = FALSE))

## Grand Mean Center AVG_TIME_PRAC_1

df9 <- df9 %>% mutate(GMC_TIME_PRAC_1 = scale(AVG_TIME_PRAC_1, scale = FALSE))

## Grand Mean Center AVG_TIME_PRAC_2

df9 <- df9 %>% mutate(GMC_TIME_PRAC_2 = scale(AVG_TIME_PRAC_2, scale = FALSE))

## Grand Mean Center AVG_TIME_EST_1

df9 <- df9 %>% mutate(GMC_TIME_EST_1 = scale(AVG_TIME_EST_1, scale = FALSE))

## Grand Mean Center AVG_TIME_EST_2

df9 <- df9 %>% mutate(GMC_TIME_EST_2 = scale(AVG_TIME_EST_2, scale = FALSE))

## Grand Mean Center pre and post confidence, emotions, etc

df9 <- df9 %>% 
  mutate(GMC_PRE_CONF = scale(PRE_CONFIDENCEn, scale = FALSE),
         GMC_EMO_EFFORT_1 = scale(EMO_REG_EFFORT1n, scale = FALSE),
         GMC_EMO_EFFORT_2 = scale(EMO_REG_EFFORT2n, scale = FALSE),
         GMC_POST_CONF = scale(POST_CONFIDENCEn, scale = FALSE),
         GMC_ADVICE_ACC = scale(PERCEIVED_ADVICE_ACCURACYn, scale = FALSE))
         

```


# Pull dataframes together
```{r}


youngdf <- select(young, ID, PRAC01_WOA, PRAC02_WOA, PRAC03_WOA, JAR01_WOA, JAR02_WOA,
                  JAR03_WOA, JAR04_WOA, JAR05_WOA, JAR06_WOA, JAR07_WOA, JAR08_WOA,
                  JAR09_WOA, JAR10_WOA, JAR11_WOA, JAR12_WOA, DASS, DASS_SEVERITY,
                  AVFLUIDIQ)

middledf <- select(middle, ID, PRAC01_WOA, PRAC02_WOA, PRAC03_WOA, JAR01_WOA, JAR02_WOA,
                  JAR03_WOA, JAR04_WOA, JAR05_WOA, JAR06_WOA, JAR07_WOA, JAR08_WOA,
                  JAR09_WOA, JAR10_WOA, JAR11_WOA, JAR12_WOA, DASS, DASS_SEVERITY,
                  AVFLUIDIQ)

olderdf <- select(older, ID, PRAC01_WOA, PRAC02_WOA, PRAC03_WOA, JAR01_WOA, JAR02_WOA,
                  JAR03_WOA, JAR04_WOA, JAR05_WOA, JAR06_WOA, JAR07_WOA, JAR08_WOA,
                  JAR09_WOA, JAR10_WOA, JAR11_WOA, JAR12_WOA, DASS, DASS_SEVERITY,
                  AVFLUIDIQ)

ja1 <- select(df9,ID, GENDER, AGEn, AGEGROUP, MARITAL_STATn, EDUn, CURRENT_HEALTHn, PRAC1_1n, PRAC1_2n,
              PRAC1_3n, prac2_1_advicen, prac2_2_advicen, prac2_3_advicen, PRE_CONFIDENCEn,
              EMO_REGn, EMO_REG_EFFORT1n, EMO_REG_EFFORT2n, POST_CONFIDENCEn,
              PERCEIVED_ADVICE_ACCURACYn, AVG_TIME_PRAC_1, AVG_TIME_PRAC_2, 
              AVG_TIME_EST_1, AVG_TIME_EST_2)


# Combine the age group dfs together

all_ages <- youngdf %>% full_join(middledf)
  
all_ages <- all_ages %>% full_join(olderdf)

# Combine all ages with the ja

full_ja_df <- ja1 %>% left_join(all_ages)

full_ja_df$GENDER <- as.factor(full_ja_df$GENDER)

tabyl(full_ja_df, GENDER, AGEGROUP)

full_ja_df %>% 
  group_by(AGEGROUP) %>% 
  get_summary_stats(type = "common")


```

# Save data file
```{r}

# save(full_ja_df, file = "Judge_Advisor_2022_preprocessed.RData")

# write.csv(full_ja_df, "JA_2022_Full_Data_preprocessed.csv", row.names = FALSE)

```









